Framework.Actions={add_activity:function(b,a){a=a||{};if(a.bForceLogin&&!Framework.Authentication.isUserLoggedIn()){Framework.Authentication.promptLogin({callback:function(){Framework.Actions.add_activity(b,a)}});return}b.owner=Framework.User.id;b.pic=Framework.User.pic;Framework.Services.get_geocode_details(b.address,{callback:function(c){b.latlong=c.latlong;Framework.Services.add_activity(b,{callback:function(d){b.id=d;Framework.Analytics.trackAction("action","edit-activity","done");if(a.callback){a.callback(b)}}})}})},invite_people:function(f,a){a=a||{};if(a.bForceLogin&&!Framework.Authentication.isUserLoggedIn()){Framework.Authentication.promptLogin({callback:function(){Framework.Actions.invite_people(f,a)}});return}f.message=f.message.replace(new RegExp("\n","gm"),"\n<br/>");if(f.emailto){var g=f.emailto.split(",");for(var c=0;c<g.length;c++){if(!g[c]){continue}var b=f.subject||Framework.User.name+" invites you to a circle - "+f.title;var d;if(a.bTemplatize){f=Framework.ActivityStore.get_activity_padded(f);f.emailto=g[c];d=Framework.Utils.tmpl(Framework.Constants.TEMPLATES.email,f)}else{var e="http://www.opencirclez.com";d=f.message.replace(new RegExp(e),'<a href="'+e+"#signin="+g[c]+'" target=_blank>'+e+"#signin="+g[c]+"</a>");d+="\n<br/>\n<br/>--\n<br/>"+Framework.User.name}Framework.Services.send_message({from:Framework.User.id,fromName:f.fromName||Framework.User.name,to:g[c],subject:b,message:d})}Framework.Analytics.trackAction("action","invite-people","done")}if(a.callback){a.callback()}},add_message:function(b,a){a=a||{};b.activity=b.activity||Framework.ActivityStore.get_activity_by_id(b.eventid);if(a.bForceLogin&&!Framework.Authentication.isUserLoggedIn()){Framework.Authentication.promptLogin({callback:function(){Framework.Actions.add_message(b,a)}});return}Framework.Services.add_message({eventid:b.eventid,message:b.message},{callback:function(){Framework.Analytics.trackAction("action","add-msg","done");if(window.show_user_message){show_user_message(b.eventid,Framework.User,b.message)}if(a.callback){a.callback()}}})},send_message:function(b,a){a=a||{};b.activity=b.activity||Framework.ActivityStore.get_activity_by_id(b.eventid);if(a.bForceLogin&&!Framework.Authentication.isUserLoggedIn()){Framework.Authentication.promptLogin({callback:function(){Framework.Actions.send_message(b,a)}});return}var c="<a href='"+Framework.User.url+"' target=_blank>					<img alt=\""+Framework.User.name+'" title="'+Framework.User.name+"\" src='"+Framework.User.pic+"'/>					</a> says : "+b.message+"<br/><br/><a href='"+Framework.SITE_URL+"#eventid="+b.eventid+"'>Click here to view event details</a>";Framework.Services.send_message({to:b.userid,from:Framework.User.id,message:c,subject:Framework.User.name+' sent you a message about "'+b.activity.name+'"'},{callback:function(){Framework.Analytics.trackAction("action","send-msg","done");if(a.callback){a.callback()}}})}};Framework.Analytics=new function(){var a=this;a.gametrics=null;a.startTime=(new Date()).getTime();a.trackAction=function(){try{if(a.gametrics){var d=[];for(var c=0;c<arguments.length;c++){if(!arguments[c]){continue}d.push(arguments[c].replace("/",""))}a.gametrics._trackPageview(d.join("/"))}else{var b=arguments;setTimeout(function(){a.trackAction.apply(a,b)},5000)}}catch(f){console.error("Problem tracking action",f)}};a.trackEvent=function(d,f,h){try{h=h?h:{};if(a.gametrics){var b=JSON.stringify(h);if(b.length<255){a.gametrics._trackEvent(d,f,b)}}else{var c=arguments;setTimeout(function(){a.trackEvent.apply(a,c)},5000)}}catch(g){console.error("Problem tracking event",g)}};a.trackAllClicks=function(b){jQuery(document).click(function(f){try{var h=function(e){return(typeof(e)=="undefined"||e===null||jQuery.trim(e)==="")?false:true};var c=jQuery(f.target);if(!h(c.attr("title"))&&!h(c.attr("id"))&&!h(c.text())&&!h(c.attr("src"))){c=c.parent()}var d={title:c.attr("title"),id:c.attr("id"),className:c.attr("className"),text:jQuery.trim(c.text()),type:c.attr("tagName"),src:c.attr("src")};if(d.type!="html"){a.trackEvent(b,"click",d)}}catch(g){}})};a.loadGoogleAnalytics=function(d){if(!window._gat){var c=document.createElement("script");c.type="text/javascript";c.async=true;c.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(c,b);c.onload=c.onreadystatechange=function(){if(window._gat){a.gametrics=_gat._getTracker(a.getUAString());a.gametrics._setDomainName(a.getDomain());a.gametrics._setAllowLinker(true);a.gametrics._setAllowHash(false);if(d){d()}}}}};a.switchAnalytics=function(b){if(window._gat){a.gametrics=_gat._getTracker(b);a.gametrics._trackPageview(window.location.pathname+window.location.search+escape(window.location.hash))}};a.trackPageLoad=function(){var b={};var c=window.location.pathname;jQuery(document).ready(function(){b.dom=Math.floor(((new Date()).getTime()-a.startTime)/1000)});jQuery(window).load(function(){b.window=Math.floor(((new Date()).getTime()-a.startTime)/1000);a.trackEvent(c,"load",b)})};a.getUAString=function(){var c=window.location.hostname;var b={"www.open-circles":"UA-7350646-6","www.opencirclez":"UA-7350646-9","fb.opencirclez":"UA-7350646-9","music.opencirclez":"UA-7350646-9"};for(key in b){if(b.hasOwnProperty(key)){var d=new RegExp(key);if(c.match(d)){return b[key]}}}return"UA-7350646-3"};a.getDomain=function(){var c=["production"];for(var b=0;b<c.length;b++){if(window.location.hostname.indexOf(c[b])>-1){return"."+c[b]}}return"none"}};jQuery(document).ready(function(){if(window.location.search.indexOf("notrack")>-1||$.cookie("notrack")){$.cookie("notrack",true);return}try{setTimeout(function(){Framework.Analytics.loadGoogleAnalytics(function(){Framework.Analytics.trackAction((window.location.pathname=="/"?"index.html":window.location.pathname)+window.location.search+window.location.hash);Framework.Analytics.trackPageLoad();Framework.Analytics.trackAllClicks(window.location.pathname+window.location.search)})},1000)}catch(a){console.error("cannot load analytics")}});Framework.Authentication={getLogin:function(a){Framework.Services.get_login_details({callback:function(b){if(b.result=="none"){if(window.MyLikes){MyLikes.setupLikes()}if(a){a()}return}Framework.User=Framework.Utils.get_formatted_users(b);if(window.MyLikes){MyLikes.setupLikes()}jQuery(".upper-signin").removeClass("upper-signin").addClass("upper-signout");jQuery(".upper-logged-in").html("Hi, <a>"+Framework.Utils.shorten(Framework.User.name,10)+"</a>").find("a").click(function(){Framework.Authentication.promptUpdate()});jQuery(".signin_prompt").css("display","none");if(a){a()}}})},isUserLoggedIn:function(){if(Framework.User.id){return true}else{return false}},promptUpdate:function(b,a){a=a||{};Framework.Analytics.trackAction("auth","update","prompt");b=b||{};jQuery("#auth_dialog").dialog("destroy").html("");jQuery("#auth_dialog").dialog({title:b.title||"Account Info",width:Math.min(500,jQuery(".ui-body").width()*0.8),height:600,buttons:{Save:function(d){d.stopPropagation();Framework.Analytics.trackAction("auth","update","save");var c=jQuery.editUI.getVals(jQuery("#auth_dialog"));if(!c.email){alert("Email is invalid");return}if(c.password!=c["confirm-pass"]){alert("Passwords don't match");return}var f=function(){c.latlong=Framework.Utils.geocode().latlong;Framework.Services.update_login(c,{callback:function(e){Framework.Analytics.trackAction("auth","update","done");Framework.Authentication.getLogin();jQuery("#auth_dialog").dialog("close");if(a.callback){a.callback()}}})};if(c.user_loc==Framework.Utils.geocode().area){f()}else{Framework.Services.get_geocode_details(c.user_loc,{callback:function(e){Framework.Utils.geocode(e);jQuery("#input_location").val(e.area);f()}})}}},close:function(){jQuery("#auth_dialog").dialog("destroy").html("")},open:function(){var c=jQuery('<a><span class="persons" style="display: inline-block"></span>Invite Friends</a>');c.click(Framework.InviteFriends);jQuery(".ui-dialog-buttonpane:visible").prepend(c);var d=[{key:"email",type:"email",label:"Email",help:"We promise not to reveal this to anyone",defaultValue:""},{key:"name",type:"string",label:"Name",help:"Your identity on OpenCirclez",defaultValue:""},{key:"pic",type:"uploader",label:"Pic",target:"/img",defaultValue:""},{key:"activities",type:"string",label:"My Likes",help:"Activities you like (separate with commas)",defaultValue:""},{key:"more-details",type:"link",label:"+ more details",onClick:function(){jQuery.editUI.showOptional(jQuery("#auth_dialog"))}},{key:"user_loc",type:"string",label:"Location",help:"City, zipcode or address",optional:true,defaultValue:""},{key:"radius",type:"dropdown",label:"Distance (miles)",choices:[1,2,5,10,15,20,25],defaultValue:15,optional:true,help:"How far are you willing to travel?"},{key:"url",type:"string",label:"Social profile",optional:true,help:"Recommended to build trust",defaultValue:""},{key:"password",type:"password",label:"Password",optional:true,defaultValue:""},{key:"confirm-pass",type:"password",label:"Confirm",optional:true,defaultValue:""}];jQuery.editUI(jQuery("#auth_dialog"),d);Framework.User.user_loc=Framework.Utils.geocode().area;Framework.User.activities=MyLikes.activities.join(",");jQuery.editUI.setVals(jQuery("#auth_dialog"),Framework.User)}})},promptLogin:function(b){b=b||{};var a=function(){jQuery("#auth_dialog").dialog("close");Framework.Analytics.trackAction("auth","facebook","prompt");Framework.Facebook.loginCheck(function(){var c=Framework.Facebook.user;if(c){Framework.Analytics.trackAction("auth","facebook","login");c.latlong=Framework.Utils.geocode().latlong;c.activities=MyLikes.activities.join(",");c.referral=$.cookie("referral")||"";Framework.Services.login(c,{callback:function(d){if(d.result=="exists"){alert("Did you set a password?");Framework.Authentication.promptLogin(b)}else{Framework.Authentication.getLogin(b.callback)}}})}else{Framework.Analytics.trackAction("auth","facebook","cancel")}},true)};Framework.Facebook.init();if(Framework.Utils.inFacebook()){a();return}Framework.Analytics.trackAction("auth","login","prompt");jQuery("#auth_dialog").dialog("destroy").html("");jQuery("#auth_dialog").dialog({title:"Just One More Step (Sign In)",width:Math.min(500,jQuery(".ui-body").width()*0.8),height:340,buttons:{Login:function(f){f.stopPropagation();Framework.Analytics.trackAction("auth","login","save");var d=jQuery.editUI.getVals(jQuery("#auth_dialog"));if(!d.email){alert("Email is invalid");return}d.latlong=Framework.Utils.geocode().latlong;d.activities=MyLikes.activities.join(",");d.referral=$.cookie("referral")||"";var c=false;Framework.Services.login(d,{callback:function(e){c=true;if(e.result=="wrong"){Framework.Analytics.trackAction("auth","login","wrong");alert("Wrong password")}else{Framework.Analytics.trackAction("auth","login","done");Framework.Authentication.getLogin(function(){if(e["new"]){Framework.Authentication.promptUpdate({title:"Add More Details"},b)}else{jQuery("#auth_dialog").dialog("close");if(b.callback){b.callback()}}})}}});setTimeout(function(){if(!c){Framework.Services.send_message({to:"admin@opencirclez.com",from:"admin@opencirclez.com",message:$.toJSON(d),subject:"Problem signing in"},{callback:function(){alert("There was a problem signing up. A message has been sent to OpenCirclez support. Please try again tomorrow.")}})}},5000)}},close:function(){jQuery("#auth_dialog").dialog("destroy").html("")},open:function(){var c=jQuery('<a><span class="fb-login"></span>Login using Facebook</a>');c.click(a);jQuery(".ui-dialog-buttonpane:visible").prepend(c);jQuery.editUI(jQuery("#auth_dialog"),[{key:"email",type:"email",label:"Email",defaultValue:""},{key:"password",type:"password",label:"Password",defaultValue:""},{key:"forgot-pass",type:"link",label:"Forgot password? Email it!",onClick:function(){Framework.Analytics.trackAction("auth","login","forgot");var d=jQuery.editUI.getVals(jQuery("#auth_dialog"));if(!d.email){alert("Email is invalid");return}Framework.Services.reset_password({email:d.email,latlong:Framework.Utils.geocode().latlong},{callback:function(){alert("Password was sent to "+d.email)}})}}])}})}};Framework.ActivityStore={cache:[],current:[],keywords:{},resetEverything:function(){this.cache=[];this.current=[];this.keywords={}},fetchResults:function(j){j=j||{};this.resetEverything();var d=j.filters||{};if(j.source=="eventid"){Framework.Services.get_event({eventid:d.eventid},{callback:function(k){k.name=k.title;k.time=parseInt(k.starttime);delete k.title;Framework.ActivityStore.current.push(k);Framework.ActivityStore.cache.push(k);j.callback()},onFailure:function(){j.callback()}})}else{d.activity=d.activity||"";$.cookie("activity",d.activity);d.activity=Framework.Utils.strip_stopwords(d.activity.toLowerCase());d.time=d.time||Framework.Utils.get_time_12am()+",";d.location=Framework.Utils.geocode().latlong;Framework.Analytics.trackAction("search","source",j.source);Framework.Analytics.trackEvent("search",j.source,d.activity);var f=d.activity.split(",");for(var e=0;e<f.length;e++){Framework.ActivityStore.keywords[f[e].toLowerCase()]=0}var g=d.location.split(",")[0];var a=d.location.split(",")[1];var c=0;var h=function(){c=c-1;if(c<=0){j.callback()}};c++;var b=d.time.split(",");this.getInhouseResults({start:b[0],end:b[1],timeless:b[1]?0:1,latlong:d.location,radius:d.radius,keyword:d.activity.indexOf(",")>-1?"":d.activity},{keywords:f,callback:function(){h()}});c++;this.getMeetupResults({lon:a,lat:g,radius:d.radius,time:d.time,text:jQuery.trim(d.activity.replace(/,/gim," "))},{keywords:f,callback:function(){h()}})}},getInhouseResults:function(b,a){Framework.Services.get_events(b,{callback:function(c){for(var d=0;d<c.length;d++){var e=c[d];e.name=e.title;delete e.title;e.time=parseInt(e.starttime);e.url=e.url||"";e.quality=e.quality?parseInt(e.quality):10;e.source="From Our Users";e.cost=e.cost||"";e.distance=e.distance||0;e.distance=(e.distance/1600).toFixed(1);Framework.ActivityStore.addIfRelevant(e,a.keywords)}Framework.ActivityStore.current=Framework.ActivityStore.sort_by_coolness(Framework.ActivityStore.current);if(a.callback){a.callback()}},onFailure:function(){if(a.callback){a.callback()}}})},getRhythmismResults:function(c,a){var b='select * from html where url="http://www.rhythmism.com/forum/calendar.php?c=1&do=displayweek"';Framework.Services.makeYqlCall(b,{format:"xml",callback:function(d){var e=jQuery(d.results[0].replace(/<img.*?>/gim,"").replace(new RegExp("(<script[^>]*>([\\S\\s]*?)<\/script>)","gim"),"")).find("table.tborder:eq(1) td.alt1");e.each(function(){var f={};f.name="Party: "+jQuery(this).find("a").text();f.description=jQuery(this).find("a").attr("title");f.url="http://www.rhythmism.com"+jQuery(this).find("a").attr("href");f.time=Date.parseExact(jQuery(this).attr("title"),"MMMM d yyyy").getTime();f.source="Rhythmism.com";f.cost=f.cost||"";Framework.ActivityStore.addIfRelevant(f,a.keywords)});Framework.ActivityStore.current=Framework.ActivityStore.sort_by_coolness(Framework.ActivityStore.current);if(a.callback){a.callback()}},onFailure:function(){if(a.callback){a.callback()}}})},getFlavorPillResults:function(e,a){var c=(new Date(parseInt(e.time.split(",")[0])));var d=Framework.Utils.get_time_12am(c);var b='select * from html where url="http://flavorpill.com/newyork/events/'+c.toString("yyyy/MM/dd")+'"';Framework.Services.makeYqlCall(b,{format:"xml",callback:function(f){var g=jQuery(f.results[0].replace(/<img.*?>/gim,"").replace(new RegExp("(<script[^>]*>([\\S\\s]*?)<\/script>)","gim"),"")).find(".single_event");g.each(function(){var h={};h.name=jQuery(this).find(".genre a:eq(0)").text()+": "+jQuery(this).find(".title").text();h.name=h.name.replace(/<.*?>/g,"").replace(/"|(\n\s*)/g," ");h.description=jQuery(this).find(".short_description").text();h.address=jQuery(this).find(".venue").text();h.time=d;h.url="http://flavorpill.com"+jQuery(this).find(".title a").attr("href");h.id=h.url;h.source="FlavorPill.com";h.cost=h.cost||"";Framework.ActivityStore.addIfRelevant(h,a.keywords)});Framework.ActivityStore.current=Framework.ActivityStore.sort_by_coolness(Framework.ActivityStore.current);if(a.callback){a.callback()}},onFailure:function(){if(a.callback){a.callback()}}})},getGoogleMovieResults:function(d,b){var a=d.location.split(",");var c='select * from data.html.cssselect where url="http://www.google.com/movies?near='+a[0]+","+a[1]+'&hl=en&sort=1" and css="div.movie"';Framework.Services.makeYqlCall(c,{format:"xml",callback:function(e){var f=jQuery(Framework.Utils.parseXml(e.results[0])).find(".movie");f.each(function(){var h={};var g=jQuery(this);h.name="Movie: "+g.find(".desc h2").text();g.find(".info:eq(0), .syn span").remove();h.description=g.find(".syn").text()+"...";h.address=g.find(".theater:eq(0) .name").text()+"<br/>"+g.find(".theater:eq(0) .address").text();h.coords=jQuery.trim(g.find(".theater:eq(0) .address").text());h.url="http://www.google.com"+g.find(".desc h2 a").attr("href");h.time=Date.parse(g.find(".times:eq(0) a:eq(0)").text()||"now");Framework.ActivityStore.cache.push(h);Framework.ActivityStore.current.push(h)})}})},getCraigslistResults:function(g,b){g.text=g.text||" ";var h={Manhattan:"mnh",Brooklyn:"brk",Queens:"que",Bronx:"brx","Staten Island":"stn","New Jersey":"jsy","Long Island":"lgi",Westchester:"wch",Fairfield:"fct"};var e={"San Francisco":"sfc","Santa Clara":"sby",Alameda:"eby","San Mateo":"pen",Marin:"nby","Santa Cruz":"scz"};var c=Framework.Utils.geocode();var a,d,f;if(c.state=="CA"&&parseInt(c.latlong.split(",")[1])>35){a="sfbay";if(e[c.area]){d=e[c.area]}}else{if(c.state=="NY"){a="newyork";if(h[c.area]){d=h[c.area]}}else{b.callback([]);return}}if(d){f='use "http://beta.open-circles.org/yqltables/craigslist.search.xml" as craigslist;';f+='select * from craigslist where location="'+a+'" and type="act" and area="'+d+'" and query="'+g.text+'"'}else{f='select * from craigslist.search where location="'+a+'" and type="act" and query="'+g.text+'"'}Framework.Services.makeYqlCall(f,{callback:function(j){var l=Framework.Utils.findProperty("item",j)||[];var n=[];for(var k=0;k<l.length&&k<10;k++){var m={};m.url=l[k].link||"";m.time=l[k].date||"";m.name=l[k].title.length?l[k].title[0]:l[k].title;m.description=l[k].description.replace(/<.*?>/g,"");m.address=d?c.area:c.city;n.push(m)}b.callback(n)},onFailure:function(){b.callback([])}})},analyze_personalized:function(c,l){var e,d,f=l.keywords,b=[],g=new Array(c.results.length);for(e=0;e<f.length;e++){f[e]={index:e,word:jQuery.trim(f[e]),cnt:0}}for(e=0;e<c.results.length;e++){if(typeof(g[e])=="undefined"){g[e]=new Array(f.length)}var k=c.results[e].name+c.results[e].description;for(d=0;d<f.length;d++){if(k.match(new RegExp(f[d].word,"im"))){g[e][d]=1;f[d].cnt++}}}f.sort(function(m,j){return m.cnt-j.cnt});var h=[];for(e=0;e<f.length;e++){if(f[e].cnt){h.push(f[e].word)}}var a=0;for(d=0;d<f.length;d++){for(e=0;e<g.length;e++){if(g[e][d]&&!b[e]){b.push(c.results[e]);a++;if(a==3){a=0;break}}}if(b.length>=10){break}}return{activities:b,keywords:h}},sort_by_coolness:function(a){a.sort(function(d,c){d.quality=d.quality?d.quality:0;c.quality=c.quality?c.quality:0;d.hasmsg=isNaN(parseInt(d.hasmsg))?0:parseInt(d.hasmsg);c.hasmsg=isNaN(parseInt(c.hasmsg))?0:parseInt(c.hasmsg);if(d.quality!=c.quality){return c.quality-d.quality}else{if(d.hasmsg&&c.hasmsg){return d.hasmsg-c.hasmsg}else{if(d.hasmsg||c.hasmsg){return d.hasmsg?-1:1}else{if(d.timeless||c.timeless){return d.timeless?1:-1}else{return d.time-c.time}}}}});return a},get_formatted_meetup_activity:function(b){try{b.name=b.name.replace(/<.*?>/g,"").replace(/"|(\n\s*)/g," ");if(b.venue){b.address="";b.address+=(b.venue.address_1||"");b.address+=(b.venue.address_2||"");b.coords=b.venue.lat+","+b.venue.lon}b.description=b.description||"";b.description=b.description.replace(/<img.*?>/g,"");b.description=HTMLtoXML(b.description);b.url=b.event_url||"";if(!b.id){b.id=b.url}}catch(a){Framework.Utils.error("invalid activity")}return b},get_activity_padded:function(a){a.name=a.name||"";a.title=a.name;a.description=a.description||"";a.address=a.address||"";a.url=a.url||"";return a},get_activity_by_id:function(b){if(!b){return null}for(var a=0;a<this.cache.length;a++){if(this.cache[a].url==b||this.cache[a].id==b){return this.cache[a]}}},getMeetupResults:function(b,a){b.key="345c59636b6d3e5976513744661663a";Framework.Services.makeJsonpCall("http://api.meetup.com/2/open_events.json?"+Framework.Utils.get_as_url_params(b),{callback:function(c){for(var d=0;d<c.results.length;d++){c.results[d].source="Meetup.com";c.results[d].cost=c.results[d].cost||"";c.results[d].hasmsg=c.results[d].yes_rsvp_count||0;c.results[d].pic=Framework.SITE_URL+"images/meetup_logo.gif";c.results[d].distance=c.results[d].distance||0;c.results[d].distance=c.results[d].distance.toFixed(1);Framework.ActivityStore.addIfRelevant(Framework.ActivityStore.get_formatted_meetup_activity(c.results[d]),a.keywords)}Framework.ActivityStore.current=Framework.ActivityStore.sort_by_coolness(Framework.ActivityStore.current);if(a.callback){a.callback()}},onFailure:function(){if(a.callback){a.callback()}}})},isDuplicate:function(e){var b=false;for(var d=0;d<Framework.ActivityStore.cache.length;d++){var f=e.name.split(" ");var c=f.length;for(var a=0;a<f.length;a++){if(Framework.ActivityStore.cache[d].name.indexOf(f[a])>-1){c=c-1}}if(c==0){b=true;if(Framework.ActivityStore.cache[d].source!="From Our Users"&&e.source=="From Our Users"){b=false;Framework.ActivityStore.cache.splice(d,1)}break}}return b},addIfRelevant:function(d,c){if(Framework.ActivityStore.isDuplicate(d)){return}var b=(d.name+d.description).match(new RegExp(c.join("|"),"gim"));if(d.name&&b!=null){for(var a=0;a<b.length;a++){Framework.ActivityStore.keywords[b[a].toLowerCase()]++}d.pic=d.pic||Framework.SITE_URL+"images/anonymous.jpg";Framework.ActivityStore.cache.push(d);Framework.ActivityStore.current.push(d)}},getLinkToActivity:function(a){return Framework.SITE_URL+"#eventid="+a}};Framework.Constants={SUGGESTIONS:["sports","theater","improv","food","music","capoeira","hiking","language","acting","baseball","cinema","film","art","cricket","gaming","singing","football","soccer","yoga","biking","irish music","music practice","poetry","running","scrabble","praying","church","skating","salsa dancing","square dancing"],DEFAULT_KEYWORDS:"",TAGLINES:{suggestions:"Food, Games, Music, Film, Sports",arrow:"Invite people for company",arrow_reply:"Leave a message",btntext:"Start A Circle",btntext_reply:"Join The Circle",msg_prompt:"This looks interesting. Would anyone like to join me?",start_prompt:"Lets meet "},TEMPLATES:{}};jQuery.cookie=function(b,j,m){if(typeof j!="undefined"){m=m||{};if(j===null){j="";m.expires=-1}var e="";if(m.expires&&(typeof m.expires=="number"||m.expires.toUTCString)){var f;if(typeof m.expires=="number"){f=new Date();f.setTime(f.getTime()+(m.expires*24*60*60*1000))}else{f=m.expires}e="; expires="+f.toUTCString()}var l=m.path?"; path="+(m.path):"";var g=m.domain?"; domain="+(m.domain):"";var a=m.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(j),e,l,g,a].join("")}else{var d=null;if(document.cookie&&document.cookie!=""){var k=document.cookie.split(";");for(var h=0;h<k.length;h++){var c=jQuery.trim(k[h]);if(c.substring(0,b.length+1)==(b+"=")){d=decodeURIComponent(c.substring(b.length+1));break}}}return d}};(function($){$.toJSON=function(o){if(typeof(JSON)=="object"&&JSON.stringify){return JSON.stringify(o)}var type=typeof(o);if(o===null){return"null"}if(type=="undefined"){return undefined}if(type=="number"||type=="boolean"){return o+""}if(type=="string"){return $.quoteString(o)}if(type=="object"){if(typeof o.toJSON=="function"){return $.toJSON(o.toJSON())}if(o.constructor===Date){var month=o.getUTCMonth()+1;if(month<10){month="0"+month}var day=o.getUTCDate();if(day<10){day="0"+day}var year=o.getUTCFullYear();var hours=o.getUTCHours();if(hours<10){hours="0"+hours}var minutes=o.getUTCMinutes();if(minutes<10){minutes="0"+minutes}var seconds=o.getUTCSeconds();if(seconds<10){seconds="0"+seconds}var milli=o.getUTCMilliseconds();if(milli<100){milli="0"+milli}if(milli<10){milli="0"+milli}return'"'+year+"-"+month+"-"+day+"T"+hours+":"+minutes+":"+seconds+"."+milli+'Z"'}if(o.constructor===Array){var ret=[];for(var i=0;i<o.length;i++){ret.push($.toJSON(o[i])||"null")}return"["+ret.join(",")+"]"}var pairs=[];for(var k in o){var name;var type=typeof k;if(type=="number"){name='"'+k+'"'}else{if(type=="string"){name=$.quoteString(k)}else{continue}}if(typeof o[k]=="function"){continue}var val=$.toJSON(o[k]);pairs.push(name+":"+val)}return"{"+pairs.join(", ")+"}"}};$.evalJSON=function(src){if(typeof(JSON)=="object"&&JSON.parse){return JSON.parse(src)}return eval("("+src+")")};$.secureEvalJSON=function(src){if(typeof(JSON)=="object"&&JSON.parse){return JSON.parse(src)}var filtered=src;filtered=filtered.replace(/\\["\\\/bfnrtu]/g,"@");filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered)){return eval("("+src+")")}else{throw new SyntaxError("Error parsing JSON, source is not valid.")}};$.quoteString=function(string){if(string.match(_escapeable)){return'"'+string.replace(_escapeable,function(a){var c=_meta[a];if(typeof c==="string"){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+string+'"'};var _escapeable=/["\\\x00-\x1f\x7f-\x9f]/g;var _meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"}})(jQuery);Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|after|from)/i,subtract:/^(\-|before|ago)/i,yesterday:/^yesterday/i,today:/^t(oday)?/i,tomorrow:/^tomorrow/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^min(ute)?s?/i,hour:/^h(ou)?rs?/i,week:/^w(ee)?k/i,month:/^m(o(nth)?s?)?/i,day:/^d(ays?)?/i,year:/^y((ea)?rs?)?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a|p)/i},abbreviatedTimeZoneStandard:{GMT:"-000",EST:"-0400",CST:"-0500",MST:"-0600",PST:"-0700"},abbreviatedTimeZoneDST:{GMT:"-000",EDT:"-0500",CDT:"-0600",MDT:"-0700",PDT:"-0800"}};Date.getMonthNumberFromName=function(b){var e=Date.CultureInfo.monthNames,a=Date.CultureInfo.abbreviatedMonthNames,d=b.toLowerCase();for(var c=0;c<e.length;c++){if(e[c].toLowerCase()==d||a[c].toLowerCase()==d){return c}}return -1};Date.getDayNumberFromName=function(b){var f=Date.CultureInfo.dayNames,a=Date.CultureInfo.abbreviatedDayNames,e=Date.CultureInfo.shortestDayNames,d=b.toLowerCase();for(var c=0;c<f.length;c++){if(f[c].toLowerCase()==d||a[c].toLowerCase()==d){return c}}return -1};Date.isLeapYear=function(a){return(((a%4===0)&&(a%100!==0))||(a%400===0))};Date.getDaysInMonth=function(a,b){return[31,(Date.isLeapYear(a)?29:28),31,30,31,30,31,31,30,31,30,31][b]};Date.getTimezoneOffset=function(a,b){return(b||false)?Date.CultureInfo.abbreviatedTimeZoneDST[a.toUpperCase()]:Date.CultureInfo.abbreviatedTimeZoneStandard[a.toUpperCase()]};Date.getTimezoneAbbreviation=function(b,d){var c=(d||false)?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard,a;for(a in c){if(c[a]===b){return a}}return null};Date.prototype.clone=function(){return new Date(this.getTime())};Date.prototype.compareTo=function(a){if(isNaN(this)){throw new Error(this)}if(a instanceof Date&&!isNaN(a)){return(this>a)?1:(this<a)?-1:0}else{throw new TypeError(a)}};Date.prototype.equals=function(a){return(this.compareTo(a)===0)};Date.prototype.between=function(c,a){var b=this.getTime();return b>=c.getTime()&&b<=a.getTime()};Date.prototype.addMilliseconds=function(a){this.setMilliseconds(this.getMilliseconds()+a);return this};Date.prototype.addSeconds=function(a){return this.addMilliseconds(a*1000)};Date.prototype.addMinutes=function(a){return this.addMilliseconds(a*60000)};Date.prototype.addHours=function(a){return this.addMilliseconds(a*3600000)};Date.prototype.addDays=function(a){return this.addMilliseconds(a*86400000)};Date.prototype.addWeeks=function(a){return this.addMilliseconds(a*604800000)};Date.prototype.addMonths=function(a){var b=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+a);this.setDate(Math.min(b,this.getDaysInMonth()));return this};Date.prototype.addYears=function(a){return this.addMonths(a*12)};Date.prototype.add=function(b){if(typeof b=="number"){this._orient=b;return this}var a=b;if(a.millisecond||a.milliseconds){this.addMilliseconds(a.millisecond||a.milliseconds)}if(a.second||a.seconds){this.addSeconds(a.second||a.seconds)}if(a.minute||a.minutes){this.addMinutes(a.minute||a.minutes)}if(a.hour||a.hours){this.addHours(a.hour||a.hours)}if(a.month||a.months){this.addMonths(a.month||a.months)}if(a.year||a.years){this.addYears(a.year||a.years)}if(a.day||a.days){this.addDays(a.day||a.days)}return this};Date._validate=function(d,c,a,b){if(typeof d!="number"){throw new TypeError(d+" is not a Number.")}else{if(d<c||d>a){throw new RangeError(d+" is not a valid value for "+b+".")}}return true};Date.validateMillisecond=function(a){return Date._validate(a,0,999,"milliseconds")};Date.validateSecond=function(a){return Date._validate(a,0,59,"seconds")};Date.validateMinute=function(a){return Date._validate(a,0,59,"minutes")};Date.validateHour=function(a){return Date._validate(a,0,23,"hours")};Date.validateDay=function(c,a,b){return Date._validate(c,1,Date.getDaysInMonth(a,b),"days")};Date.validateMonth=function(a){return Date._validate(a,0,11,"months")};Date.validateYear=function(a){return Date._validate(a,1,9999,"seconds")};Date.prototype.set=function(b){var a=b;if(!a.millisecond&&a.millisecond!==0){a.millisecond=-1}if(!a.second&&a.second!==0){a.second=-1}if(!a.minute&&a.minute!==0){a.minute=-1}if(!a.hour&&a.hour!==0){a.hour=-1}if(!a.day&&a.day!==0){a.day=-1}if(!a.month&&a.month!==0){a.month=-1}if(!a.year&&a.year!==0){a.year=-1}if(a.millisecond!=-1&&Date.validateMillisecond(a.millisecond)){this.addMilliseconds(a.millisecond-this.getMilliseconds())}if(a.second!=-1&&Date.validateSecond(a.second)){this.addSeconds(a.second-this.getSeconds())}if(a.minute!=-1&&Date.validateMinute(a.minute)){this.addMinutes(a.minute-this.getMinutes())}if(a.hour!=-1&&Date.validateHour(a.hour)){this.addHours(a.hour-this.getHours())}if(a.month!==-1&&Date.validateMonth(a.month)){this.addMonths(a.month-this.getMonth())}if(a.year!=-1&&Date.validateYear(a.year)){this.addYears(a.year-this.getFullYear())}if(a.day!=-1&&Date.validateDay(a.day,this.getFullYear(),this.getMonth())){this.addDays(a.day-this.getDate())}if(a.timezone){this.setTimezone(a.timezone)}if(a.timezoneOffset){this.setTimezoneOffset(a.timezoneOffset)}return this};Date.prototype.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this};Date.prototype.isLeapYear=function(){var a=this.getFullYear();return(((a%4===0)&&(a%100!==0))||(a%400===0))};Date.prototype.isWeekday=function(){return !(this.is().sat()||this.is().sun())};Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())};Date.prototype.moveToFirstDayOfMonth=function(){return this.set({day:1})};Date.prototype.moveToLastDayOfMonth=function(){return this.set({day:this.getDaysInMonth()})};Date.prototype.moveToDayOfWeek=function(a,b){var c=(a-this.getDay()+7*(b||+1))%7;return this.addDays((c===0)?c+=7*(b||+1):c)};Date.prototype.moveToMonth=function(c,a){var b=(c-this.getMonth()+12*(a||+1))%12;return this.addMonths((b===0)?b+=12*(a||+1):b)};Date.prototype.getDayOfYear=function(){return Math.floor((this-new Date(this.getFullYear(),0,1))/86400000)};Date.prototype.getWeekOfYear=function(a){var h=this.getFullYear(),c=this.getMonth(),f=this.getDate();var k=a||Date.CultureInfo.firstDayOfWeek;var e=7+1-new Date(h,0,1).getDay();if(e==8){e=1}var b=((Date.UTC(h,c,f,0,0,0)-Date.UTC(h,0,1,0,0,0))/86400000)+1;var j=Math.floor((b-e+7)/7);if(j===k){h--;var g=7+1-new Date(h,0,1).getDay();if(g==2||g==8){j=53}else{j=52}}return j};Date.prototype.isDST=function(){console.log("isDST");return this.toString().match(/(E|C|M|P)(S|D)T/)[2]=="D"};Date.prototype.getTimezone=function(){return Date.getTimezoneAbbreviation(this.getUTCOffset,this.isDST())};Date.prototype.setTimezoneOffset=function(b){var a=this.getTimezoneOffset(),c=Number(b)*-6/10;this.addMinutes(c-a);return this};Date.prototype.setTimezone=function(a){return this.setTimezoneOffset(Date.getTimezoneOffset(a))};Date.prototype.getUTCOffset=function(){var b=this.getTimezoneOffset()*-10/6,a;if(b<0){a=(b-10000).toString();return a[0]+a.substr(2)}else{a=(b+10000).toString();return"+"+a.substr(1)}};Date.prototype.getDayName=function(a){return a?Date.CultureInfo.abbreviatedDayNames[this.getDay()]:Date.CultureInfo.dayNames[this.getDay()]};Date.prototype.getMonthName=function(a){return a?Date.CultureInfo.abbreviatedMonthNames[this.getMonth()]:Date.CultureInfo.monthNames[this.getMonth()]};Date.prototype._toString=Date.prototype.toString;Date.prototype.toString=function(c){var a=this;var b=function b(d){return(d.toString().length==1)?"0"+d:d};return c?c.replace(/dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?/g,function(d){switch(d){case"hh":return b(a.getHours()<13?a.getHours():(a.getHours()-12));case"h":return a.getHours()<13?a.getHours():(a.getHours()-12);case"HH":return b(a.getHours());case"H":return a.getHours();case"mm":return b(a.getMinutes());case"m":return a.getMinutes();case"ss":return b(a.getSeconds());case"s":return a.getSeconds();case"yyyy":return a.getFullYear();case"yy":return a.getFullYear().toString().substring(2,4);case"dddd":return a.getDayName();case"ddd":return a.getDayName(true);case"dd":return b(a.getDate());case"d":return a.getDate().toString();case"MMMM":return a.getMonthName();case"MMM":return a.getMonthName(true);case"MM":return b((a.getMonth()+1));case"M":return a.getMonth()+1;case"t":return a.getHours()<12?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case"tt":return a.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case"zzz":case"zz":case"z":return""}}):this._toString()};Date.now=function(){return new Date()};Date.today=function(){return Date.now().clearTime()};Date.prototype._orient=+1;Date.prototype.next=function(){this._orient=+1;return this};Date.prototype.last=Date.prototype.prev=Date.prototype.previous=function(){this._orient=-1;return this};Date.prototype._is=false;Date.prototype.is=function(){this._is=true;return this};Number.prototype._dateElement="day";Number.prototype.fromNow=function(){var a={};a[this._dateElement]=this;return Date.now().add(a)};Number.prototype.ago=function(){var a={};a[this._dateElement]=this*-1;return Date.now().add(a)};(function(){var g=Date.prototype,a=Number.prototype;var p=("sunday monday tuesday wednesday thursday friday saturday").split(/\s/),o=("january february march april may june july august september october november december").split(/\s/),n=("Millisecond Second Minute Hour Day Week Month Year").split(/\s/),m;var l=function(j){return function(){if(this._is){this._is=false;return this.getDay()==j}return this.moveToDayOfWeek(j,this._orient)}};for(var f=0;f<p.length;f++){g[p[f]]=g[p[f].substring(0,3)]=l(f)}var h=function(j){return function(){if(this._is){this._is=false;return this.getMonth()===j}return this.moveToMonth(j,this._orient)}};for(var d=0;d<o.length;d++){g[o[d]]=g[o[d].substring(0,3)]=h(d)}var e=function(k){return function(){if(k.substring(k.length-1)!="s"){k+="s"}return this["add"+k](this._orient)}};var b=function(j){return function(){this._dateElement=j;return this}};for(var c=0;c<n.length;c++){m=n[c].toLowerCase();g[m]=g[m+"s"]=e(n[c]);a[m]=a[m+"s"]=b(m)}}());Date.prototype.toJSONString=function(){return this.toString("yyyy-MM-ddThh:mm:ssZ")};Date.prototype.toShortDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortDatePattern)};Date.prototype.toLongDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.longDatePattern)};Date.prototype.toShortTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortTimePattern)};Date.prototype.toLongTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.longTimePattern)};Date.prototype.getOrdinal=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};(function(){Date.Parsing={Exception:function(j){this.message="Parse error at '"+j.substring(0,10)+" ...'"}};var a=Date.Parsing;var c=a.Operators={rtoken:function(j){return function(k){var l=k.match(j);if(l){return([l[0],k.substring(l[0].length)])}else{throw new a.Exception(k)}}},token:function(j){return function(k){return c.rtoken(new RegExp("^s*"+k+"s*"))(k)}},stoken:function(j){return c.rtoken(new RegExp("^"+j))},until:function(j){return function(k){var l=[],n=null;while(k.length){try{n=j.call(this,k)}catch(m){l.push(n[0]);k=n[1];continue}break}return[l,k]}},many:function(j){return function(k){var n=[],l=null;while(k.length){try{l=j.call(this,k)}catch(m){return[n,k]}n.push(l[0]);k=l[1]}return[n,k]}},optional:function(j){return function(k){var l=null;try{l=j.call(this,k)}catch(m){return[null,k]}return[l[0],l[1]]}},not:function(j){return function(k){try{j.call(this,k)}catch(l){return[null,k]}throw new a.Exception(k)}},ignore:function(j){return j?function(k){var l=null;l=j.call(this,k);return[null,l[1]]}:null},product:function(){var k=arguments[0],l=Array.prototype.slice.call(arguments,1),m=[];for(var j=0;j<k.length;j++){m.push(c.each(k[j],l))}return m},cache:function(l){var j={},k=null;return function(m){try{k=j[m]=(j[m]||l.call(this,m))}catch(n){k=j[m]=n}if(k instanceof a.Exception){throw k}else{return k}}},any:function(){var j=arguments;return function(l){var m=null;for(var k=0;k<j.length;k++){if(j[k]==null){continue}try{m=(j[k].call(this,l))}catch(n){m=null}if(m){return m}}throw new a.Exception(l)}},each:function(){var j=arguments;return function(l){var o=[],m=null;for(var k=0;k<j.length;k++){if(j[k]==null){continue}try{m=(j[k].call(this,l))}catch(n){throw new a.Exception(l)}o.push(m[0]);l=m[1]}return[o,l]}},all:function(){var k=arguments,j=j;return j.each(j.optional(k))},sequence:function(j,k,l){k=k||c.rtoken(/^\s*/);l=l||null;if(j.length==1){return j[0]}return function(p){var t=null,u=null;var w=[];for(var o=0;o<j.length;o++){try{t=j[o].call(this,p)}catch(v){break}w.push(t[0]);try{u=k.call(this,t[1])}catch(n){u=null;break}p=u[1]}if(!t){throw new a.Exception(p)}if(u){throw new a.Exception(u[1])}if(l){try{t=l.call(this,t[1])}catch(m){throw new a.Exception(t[1])}}return[w,(t?t[1]:p)]}},between:function(k,l,j){j=j||k;var m=c.each(c.ignore(k),l,c.ignore(j));return function(n){var o=m.call(this,n);return[[o[0][0],r[0][2]],o[1]]}},list:function(j,k,l){k=k||c.rtoken(/^\s*/);l=l||null;return(j instanceof Array?c.each(c.product(j.slice(0,-1),c.ignore(k)),j.slice(-1),c.ignore(l)):c.each(c.many(c.each(j,c.ignore(k))),px,c.ignore(l)))},set:function(j,k,l){k=k||c.rtoken(/^\s*/);l=l||null;return function(C){var m=null,o=null,n=null,t=null,u=[[],C],B=false;for(var w=0;w<j.length;w++){n=null;o=null;m=null;B=(j.length==1);try{m=j[w].call(this,C)}catch(z){continue}t=[[m[0]],m[1]];if(m[1].length>0&&!B){try{n=k.call(this,m[1])}catch(A){B=true}}else{B=true}if(!B&&n[1].length===0){B=true}if(!B){var x=[];for(var v=0;v<j.length;v++){if(w!=v){x.push(j[v])}}o=c.set(x,k).call(this,n[1]);if(o[0].length>0){t[0]=t[0].concat(o[0]);t[1]=o[1]}}if(t[1].length<u[1].length){u=t}if(u[1].length===0){break}}if(u[0].length===0){return u}if(l){try{n=l.call(this,u[1])}catch(y){throw new a.Exception(u[1])}u[1]=n[1]}return u}},forward:function(j,k){return function(l){return j[k].call(this,l)}},replace:function(k,j){return function(l){var m=k.call(this,l);return[j,m[1]]}},process:function(k,j){return function(l){var m=k.call(this,l);return[j.call(this,m[0]),m[1]]}},min:function(j,k){return function(l){var m=k.call(this,l);if(m[0].length<j){throw new a.Exception(l)}return m}}};var h=function(j){return function(){var k=null,n=[];if(arguments.length>1){k=Array.prototype.slice.call(arguments)}else{if(arguments[0] instanceof Array){k=arguments[0]}}if(k){for(var m=0,l=k.shift();m<l.length;m++){k.unshift(l[m]);n.push(j.apply(null,k));k.shift();return n}}else{return j.apply(null,arguments)}}};var g="optional not ignore cache".split(/\s/);for(var d=0;d<g.length;d++){c[g[d]]=h(c[g[d]])}var f=function(j){return function(){if(arguments[0] instanceof Array){return j.apply(null,arguments[0])}else{return j.apply(null,arguments)}}};var e="each any all".split(/\s/);for(var b=0;b<e.length;b++){c[e[b]]=f(c[e[b]])}}());(function(){var f=function(k){var l=[];for(var g=0;g<k.length;g++){if(k[g] instanceof Array){l=l.concat(f(k[g]))}else{if(k[g]){l.push(k[g])}}}return l};Date.Grammar={};Date.Translator={hour:function(g){return function(){this.hour=Number(g)}},minute:function(g){return function(){this.minute=Number(g)}},second:function(g){return function(){this.second=Number(g)}},meridian:function(g){return function(){this.meridian=g.slice(0,1).toLowerCase()}},timezone:function(g){return function(){var k=g.replace(/[^\d\+\-]/g,"");if(k.length){this.timezoneOffset=Number(k)}else{this.timezone=g.toLowerCase()}}},day:function(g){var k=g[0];return function(){this.day=Number(k.match(/\d+/)[0])}},month:function(g){return function(){this.month=((g.length==3)?Date.getMonthNumberFromName(g):(Number(g)-1))}},year:function(g){return function(){var k=Number(g);this.year=((g.length>2)?k:(k+(((k+2000)<Date.CultureInfo.twoDigitYearMax)?2000:1900)))}},rday:function(g){return function(){switch(g){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;this.now=true;break}}},finishExact:function(g){g=(g instanceof Array)?g:[g];var k=new Date();this.year=k.getFullYear();this.month=k.getMonth();this.day=1;this.hour=0;this.minute=0;this.second=0;for(var l=0;l<g.length;l++){if(g[l]){g[l].call(this)}}this.hour=(this.meridian=="p"&&this.hour<13)?this.hour+12:this.hour;if(this.day>Date.getDaysInMonth(this.year,this.month)){throw new RangeError(this.day+" is not a valid value for days.")}var m=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);if(this.timezone){m.set({timezone:this.timezone})}else{if(this.timezoneOffset){m.set({timezoneOffset:this.timezoneOffset})}}return m},finish:function(g){g=(g instanceof Array)?f(g):[g];if(g.length===0){return null}for(var n=0;n<g.length;n++){if(typeof g[n]=="function"){g[n].call(this)}}if(this.now){return new Date()}var k=Date.today();var q=null;var o=!!(this.days!=null||this.orient||this.operator);if(o){var p,m,l;l=((this.orient=="past"||this.operator=="subtract")?-1:1);if(this.weekday){this.unit="day";p=(Date.getDayNumberFromName(this.weekday)-k.getDay());m=7;this.days=p?((p+(l*m))%m):(l*m)}if(this.month){this.unit="month";p=(this.month-k.getMonth());m=12;this.months=p?((p+(l*m))%m):(l*m);this.month=null}if(!this.unit){this.unit="day"}if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value){this.value=1}if(this.unit=="week"){this.unit="day";this.value=this.value*7}this[this.unit+"s"]=this.value*l}return k.add(this)}else{if(this.meridian&&this.hour){this.hour=(this.hour<13&&this.meridian=="p")?this.hour+12:this.hour}if(this.weekday&&!this.day){this.day=(k.addDays((Date.getDayNumberFromName(this.weekday)-k.getDay()))).getDate()}if(this.month&&!this.day){this.day=1}return k.set(this)}}};var b=Date.Parsing.Operators,e=Date.Grammar,d=Date.Translator,j;e.datePartDelimiter=b.rtoken(/^([\s\-\.\,\/\x27]+)/);e.timePartDelimiter=b.stoken(":");e.whiteSpace=b.rtoken(/^\s*/);e.generalDelimiter=b.rtoken(/^(([\s\,]|at|on)+)/);var a={};e.ctoken=function(n){var m=a[n];if(!m){var o=Date.CultureInfo.regexPatterns;var l=n.split(/\s+/),k=[];for(var g=0;g<l.length;g++){k.push(b.replace(b.rtoken(o[l[g]]),l[g]))}m=a[n]=b.any.apply(null,k)}return m};e.ctoken2=function(g){return b.rtoken(Date.CultureInfo.regexPatterns[g])};e.h=b.cache(b.process(b.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),d.hour));e.hh=b.cache(b.process(b.rtoken(/^(0[0-9]|1[0-2])/),d.hour));e.H=b.cache(b.process(b.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),d.hour));e.HH=b.cache(b.process(b.rtoken(/^([0-1][0-9]|2[0-3])/),d.hour));e.m=b.cache(b.process(b.rtoken(/^([0-5][0-9]|[0-9])/),d.minute));e.mm=b.cache(b.process(b.rtoken(/^[0-5][0-9]/),d.minute));e.s=b.cache(b.process(b.rtoken(/^([0-5][0-9]|[0-9])/),d.second));e.ss=b.cache(b.process(b.rtoken(/^[0-5][0-9]/),d.second));e.hms=b.cache(b.sequence([e.H,e.mm,e.ss],e.timePartDelimiter));e.t=b.cache(b.process(e.ctoken2("shortMeridian"),d.meridian));e.tt=b.cache(b.process(e.ctoken2("longMeridian"),d.meridian));e.z=b.cache(b.process(b.rtoken(/^(\+|\-)?\s*\d\d\d\d?/),d.timezone));e.zz=b.cache(b.process(b.rtoken(/^(\+|\-)\s*\d\d\d\d/),d.timezone));e.zzz=b.cache(b.process(e.ctoken2("timezone"),d.timezone));e.timeSuffix=b.each(b.ignore(e.whiteSpace),b.set([e.tt,e.zzz]));e.time=b.each(b.optional(b.ignore(b.stoken("T"))),e.hms,e.timeSuffix);e.d=b.cache(b.process(b.each(b.rtoken(/^([0-2]\d|3[0-1]|\d)/),b.optional(e.ctoken2("ordinalSuffix"))),d.day));e.dd=b.cache(b.process(b.each(b.rtoken(/^([0-2]\d|3[0-1])/),b.optional(e.ctoken2("ordinalSuffix"))),d.day));e.ddd=e.dddd=b.cache(b.process(e.ctoken("sun mon tue wed thu fri sat"),function(g){return function(){this.weekday=g}}));e.M=b.cache(b.process(b.rtoken(/^(1[0-2]|0\d|\d)/),d.month));e.MM=b.cache(b.process(b.rtoken(/^(1[0-2]|0\d)/),d.month));e.MMM=e.MMMM=b.cache(b.process(e.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),d.month));e.y=b.cache(b.process(b.rtoken(/^(\d\d?)/),d.year));e.yy=b.cache(b.process(b.rtoken(/^(\d\d)/),d.year));e.yyy=b.cache(b.process(b.rtoken(/^(\d\d?\d?\d?)/),d.year));e.yyyy=b.cache(b.process(b.rtoken(/^(\d\d\d\d)/),d.year));j=function(){return b.each(b.any.apply(null,arguments),b.not(e.ctoken2("timeContext")))};e.day=j(e.d,e.dd);e.month=j(e.M,e.MMM);e.year=j(e.yyyy,e.yy);e.orientation=b.process(e.ctoken("past future"),function(g){return function(){this.orient=g}});e.operator=b.process(e.ctoken("add subtract"),function(g){return function(){this.operator=g}});e.rday=b.process(e.ctoken("yesterday tomorrow today now"),d.rday);e.unit=b.process(e.ctoken("minute hour day week month year"),function(g){return function(){this.unit=g}});e.value=b.process(b.rtoken(/^\d\d?(st|nd|rd|th)?/),function(g){return function(){this.value=g.replace(/\D/g,"")}});e.expression=b.set([e.rday,e.operator,e.value,e.unit,e.orientation,e.ddd,e.MMM]);j=function(){return b.set(arguments,e.datePartDelimiter)};e.mdy=j(e.ddd,e.month,e.day,e.year);e.ymd=j(e.ddd,e.year,e.month,e.day);e.dmy=j(e.ddd,e.day,e.month,e.year);e.date=function(g){return((e[Date.CultureInfo.dateElementOrder]||e.mdy).call(this,g))};e.format=b.process(b.many(b.any(b.process(b.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(g){if(e[g]){return e[g]}else{throw Date.Parsing.Exception(g)}}),b.process(b.rtoken(/^[^dMyhHmstz]+/),function(g){return b.ignore(b.stoken(g))}))),function(g){return b.process(b.each.apply(null,g),d.finishExact)});var h={};var c=function(g){return h[g]=(h[g]||e.format(g)[0])};e.formats=function(k){if(k instanceof Array){var l=[];for(var g=0;g<k.length;g++){l.push(c(k[g]))}return b.any.apply(null,l)}else{return c(k)}};e._formats=e.formats(["yyyy-MM-ddTHH:mm:ss","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","d"]);e._start=b.process(b.set([e.date,e.time,e.expression],e.generalDelimiter,e.whiteSpace),d.finish);e.start=function(g){try{var k=e._formats.call({},g);if(k[1].length===0){return k}}catch(l){}return e._start.call({},g)}}());Date._parse=Date.parse;Date.parse=function(a){var b=null;if(!a){return null}try{b=Date.Grammar.start.call({},a)}catch(c){return null}return((b[1].length===0)?b[0]:null)};Date.getParseFunction=function(b){var a=Date.Grammar.formats(b);return function(c){var d=null;try{d=a.call({},c)}catch(f){return null}return((d[1].length===0)?d[0]:null)}};Date.parseExact=function(a,b){return Date.getParseFunction(b)(a)};(function(){var l=/^<(\w+)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,c=/^<\/(\w+)[^>]*>/,g=/(\w+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g;var f=b("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed");var a=b("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul");var j=b("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var");var d=b("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr");var k=b("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected");var h=b("script,style");var e=this.HTMLParser=function(n,w){var q,s,o,t=[],u=n;t.last=function(){return this[this.length-1]};while(n){s=true;if(!t.last()||!h[t.last()]){if(n.indexOf("<!--")==0){q=n.indexOf("-->");if(q>=0){if(w.comment){w.comment(n.substring(4,q))}n=n.substring(q+3);s=false}}else{if(n.indexOf("</")==0){o=n.match(c);if(o){n=n.substring(o[0].length);o[0].replace(c,p);s=false}}else{if(n.indexOf("<")==0){o=n.match(l);if(o){n=n.substring(o[0].length);o[0].replace(l,m);s=false}}}}if(s){q=n.indexOf("<");var v=q<0?n:n.substring(0,q);n=q<0?"":n.substring(q);if(w.chars){w.chars(v)}}}else{n=n.replace(new RegExp("(.*)</"+t.last()+"[^>]*>"),function(x,y){y=y.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)]]>/g,"$1");if(w.chars){w.chars(y)}return""});p("",t.last())}if(n==u){throw"Parse Error: "+n}u=n}p();function m(x,A,B,y){if(a[A]){while(t.last()&&j[t.last()]){p("",t.last())}}if(d[A]&&t.last()==A){p("",A)}y=f[A]||!!y;if(!y){t.push(A)}if(w.start){var z=[];B.replace(g,function(D,C){var E=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:k[C]?C:"";z.push({name:C,value:E,escaped:E.replace(/(^|[^\\])"/g,'$1\\"')})});if(w.start){w.start(A,z,y)}}}function p(x,z){if(!z){var A=0}else{for(var A=t.length-1;A>=0;A--){if(t[A]==z){break}}}if(A>=0){for(var y=t.length-1;y>=A;y--){if(w.end){w.end(t[y])}}t.length=A}}};this.HTMLtoXML=function(n){var m="";e(n,{start:function(o,q,p){m+="<"+o;for(var s=0;s<q.length;s++){m+=" "+q[s].name+'="'+q[s].escaped+'"'}m+=(p?"/":"")+">"},end:function(o){m+="</"+o+">"},chars:function(o){m+=o},comment:function(o){m+="<!--"+o+"-->"}});return m};this.HTMLtoDOM=function(q,u){var p=b("html,head,body,title");var m={link:"head",base:"head"};if(!u){if(typeof DOMDocument!="undefined"){u=new DOMDocument()}else{if(typeof document!="undefined"&&document.implementation&&document.implementation.createDocument){u=document.implementation.createDocument("","",null)}else{if(typeof ActiveX!="undefined"){u=new ActiveXObject("Msxml.DOMDocument")}}}}else{u=u.ownerDocument||u.getOwnerDocument&&u.getOwnerDocument()||u}var n=[],t=u.documentElement||u.getDocumentElement&&u.getDocumentElement();if(!t&&u.createElement){(function(){var w=u.createElement("html");var v=u.createElement("head");v.appendChild(u.createElement("title"));w.appendChild(v);w.appendChild(u.createElement("body"));u.appendChild(w)})()}if(u.getElementsByTagName){for(var o in p){p[o]=u.getElementsByTagName(o)[0]}}var s=p.body;e(q,{start:function(y,x,w){if(p[y]){s=p[y];return}var z=u.createElement(y);for(var v in x){z.setAttribute(x[v].name,x[v].value)}if(m[y]&&typeof p[m[y]]!="boolean"){p[m[y]].appendChild(z)}else{if(s&&s.appendChild){s.appendChild(z)}}if(!w){n.push(z);s=z}},end:function(v){n.length-=1;s=n[n.length-1]},chars:function(v){s.appendChild(u.createTextNode(v))},comment:function(v){}});return u};function b(p){var o={},m=p.split(",");for(var n=0;n<m.length;n++){o[m[n]]=true}return o}})();jQuery.editUI=function(a,d,b){b=b||{};jQuery.editUI.stash[a.attr("id")]=d;for(var c=0;c<d.length;c++){var e=d[c];e.defaultValue=e.defaultValue||"";e.value=e.value||"";e.label=e.label||"";e.help=e.help||"";e.className=e.className||"ui-input-block";jQuery.editUI.render[e.type](jQuery('<div class="'+e.className+'" id="'+a.attr("id")+"_editui_"+e.key+'"></div>').appendTo(a),e)}};jQuery.editUI.stash={};jQuery.editUI.getVals=function(b){var e=jQuery.editUI.stash[b.attr("id")];var a={};for(var c=0;c<e.length;c++){var d=b.find("#input_"+e[c].key).val();if(!e[c].validate||e[c].validate(d)){a[e[c].key]=e[c].transform?e[c].transform(d):d}}return a};jQuery.editUI.setVals=function(a,d){var c=jQuery.editUI.stash[a.attr("id")];for(var b in d){if(a.find("#input_"+b).hasClass("checkbox")){a.find("#input_"+b).attr("checked",d[b])}else{a.find("#input_"+b).val(d[b])}}};jQuery.editUI.showOptional=function(a,b){if(!b){a.find(".ui-optional").show("slide",{direction:"up"},1000)}else{a.find(".ui-optional:hidden:first").show("slide",{direction:"up"},1000)}if(a.find(".ui-optional:hidden").length==0){a.find(".ui-more").remove()}};jQuery.editUI.render={autocomplete:function(a,b){this.string(a,b);a.find("input").autocomplete({minLength:0,source:b.source})},date:function(a,b){this.string(a,b);a.find("input").datepicker({changeMonth:true,changeYear:true,dateFormat:"yy-mm-dd"})},email:function(a,b){this.string(a,b);b.validate=b.validate?b.validate:function(c){return c.match(/^([a-zA-Z0-9_.-])+@(([a-zA-Z0-9-])+.)+([a-zA-Z0-9]{2,4})+$/)?true:false}},password:function(a,b){b.input_type="password";this.string(a,b)},phone:function(a,b){this.string(a,b);b.validate=b.validate?b.validate:function(c){if(!b.required&&jQuery.trim(c)==""){return true}c=b.transform(c);c=c.charAt(0)=="1"?c:"1"+c;return c.length==11?true:false};b.transform=b.transform?b.transform:function(c){return c.replace(/[^\d]/g,"")}},number:function(a,b){this.string(a,b);b.validate=b.validate?b.validate:function(c){if(!b.required&&jQuery.trim(c)==""){return true}return c.match(/[\d\-\(\)\.]+/)?true:false};b.transform=b.transform?b.transform:function(c){return c.replace(/[^\d]/g,"")}},postit:function(a,b){b.width=b.width?b.width:250;b.height=b.height?b.height:250;b.pos_x=b.pos_x?b.pos_x:0;b.pos_y=b.pos_y?b.pos_y:0;a.addClass("postit");a.parents().addClass("absolute-holder");a.css({position:"absolute",top:b.pos_y,left:b.pos_x});a.append('<label for="input_'+b.key+'">'+b.label+"</label>");b.pos_y+=a.find("label").height();a.stickyNotes({controls:false,resizable:false,maxLength:250,notes:[{id:"sticky-"+b.key,text:b.defaultValue,width:b.width,height:b.height,pos_x:b.pos_x,pos_y:b.pos_y}]});if(b.editableDefault){jQuery("#note-sticky-"+b.key+" .jStickyNote p").trigger("dblclick")}},textarea:function(c,d){var a=this;c.addClass("textarea");d.rows=d.rows||3;var b=jQuery('<textarea class="ui-corner-all" id="input_'+d.key+'"></textarea>');b.attr("rows",d.rows);if(d.optional){c.addClass("ui-optional")}c.append('<div class="label-container"><label class="ui-edit-label" for="input_'+d.key+'">'+d.label+"</label></div>");c.append(jQuery('<div class="ui-edit-input"></div>').append(b));c.append('<div class="ui-edit-help"><span>&nbsp;</span>'+d.help+"</div>");if(d.defaultValue){b.html(d.defaultValue)}b.change(function(){if(d.onChange){d.onChange(b.text())}});b.focus(function(){if(b.val()==d.defaultValue){b.val("").removeClass("ui-hint-text")}else{b.select()}});b.blur(function(){if(b.val()==""){b.val(d.defaultValue).addClass("ui-hint-text")}})},checkbox:function(c,d){var a=this;var b=jQuery('<input type="checkbox" class="checkbox ui-corner-all" id="input_'+d.key+'"></input>');if(d.optional){c.addClass("ui-optional")}c.append('<div class="label-container"><label class="ui-edit-label" for="input_'+d.key+'">'+d.label+"</label></div>");c.append(jQuery('<div class="ui-edit-input"></div>').append(b));c.append('<div class="ui-edit-help"><span>&nbsp;</span>'+d.help+"</div>");if(d.defaultValue==1){b.attr("checked","checked")}b.change(function(){if(d.onChange){d.onChange(b.attr("checked"))}});if(d.onClick){b.click(d.onClick)}d.transform=d.transform?d.transform:function(){return b.attr("checked")?1:0}},dropdown:function(e,g){var a=this;var h=g.choices;var d=jQuery('<select class="dropdown ui-corner-all" id="input_'+g.key+'"></select>');e.append('<div class="label-container"><label class="ui-edit-label" for="input_'+g.key+'">'+g.label+"</label></div>");e.append(jQuery('<div class="ui-edit-input"></div>').append(d));e.append('<div class="ui-edit-help left-padded"><span>&nbsp;</span>'+g.help+"</div>");if(h.length){for(var c=0;c<h.length;c++){var b,f;if(typeof(h[c])=="object"){b=h[c].name;f=h[c].value}else{b=f=h[c]}d.append(jQuery("<option></option>").val(f).html(b));if(f==g.defaultValue){d.find("option:last").attr("selected","selected")}}}else{for(var b in h){d.append(jQuery("<option></option>").val(h[b]).html(b));if(h[b]==g.defaultValue){d.find("option:last").attr("selected","selected")}}}d.change(function(){if(g.onChange){g.onChange(d.attr("value"))}});if(d.selectmenu){d.selectmenu({style:"dropdown"})}if(g.optional){e.addClass("ui-optional")}},string:function(c,d){var a=this;var b=jQuery('<input class="text ui-corner-all" type="'+(d.input_type||"text")+'" id="input_'+d.key+'">');if(d.optional){c.addClass("ui-optional")}if(d.value!=""){b.attr("value",d.value)}else{b.attr("value",d.defaultValue).addClass("ui-hint-text")}c.append('<div class="label-container"><label class="ui-edit-label" for="input_'+d.key+'">'+d.label+"</label></div>");c.append(jQuery('<div class="ui-edit-input"></div>').append(b).append('<div class="ui-edit-error"></div>'));c.append('<div class="ui-edit-help left-padded"><span>&nbsp;</span>'+d.help+"</div>");b.change(function(){if(d.onChange){d.onChange(b.attr("value"))}});b.focus(function(){if(b.attr("value")==d.defaultValue){b.attr("value","").removeClass("ui-hint-text")}else{b.select()}});b.blur(function(){if(b.attr("value")==""){b.attr("value",d.defaultValue).addClass("ui-hint-text")}else{if(b.qtip&&(d.validate&&d.validate(b.val())!==true)||(d.required&&jQuery.trim(b.val())=="")){b.qtip({content:"This doesnt seem right",position:{corner:{tooltip:"leftMiddle",target:"rightMiddle"}},show:{ready:true},style:{name:"cream"}})}else{if(b.qtip&&b.data("qtip")){b.qtip("destroy")}}}})},link:function(b,c){var a=jQuery('<a class="ui-clickable">'+c.label+"</a>");b.addClass("ui-more").append(a);a.click(c.onClick)},button:function(b,c){var a=jQuery("<button>"+c.label+"</button>");b.append(a);a.button().click(c.onClick)},uploader:function(a,c){a.append('<div class="label-container"><label class="ui-edit-label" for="input_'+c.key+'">'+c.label+'</label></div><div class="ui-edit-input" id="input_'+c.key+'"></div>');if(c.defaultValue){a.append('<img class="uploader-img" src="'+c.defaultValue+'"/>')}var b=new qq.FileUploader({element:a.find(".ui-edit-input")[0],action:c.target,onComplete:function(f,e,d){a.find(".ui-edit-input").val(d.path);a.find("img").remove();a.append('<img class="uploader-img" src="'+d.path+'"/>')}})},slider:function(b,d){var a=jQuery("<span>"+d.label+'</span><div class="floater-right"><input class="slider-output ui-widget-header" type="text" style="border: 0;"/></div>');var c=jQuery('<div class="ui-slider"></div>');b.append(a).append(c);if(d.optional){b.addClass("ui-optional")}if(d.help){b.append('<div class="ui-edit-help">'+d.help+"</div>")}if(typeof(d.range)=="string"){b.find(".slider-output").val(d.onChange(d.defaultValue));b.find(".ui-slider").slider({animate:true,range:d.range,min:d.min,max:d.max,value:d.defaultValue,slide:function(e,f){b.find(".slider-output").val(d.onChange(f.value))}})}else{b.find(".slider-output").val(d.onChange(d.defaultValues));b.find(".ui-slider").slider({animate:true,range:true,min:d.min,max:d.max,values:d.defaultValues,slide:function(e,f){b.find(".slider-output").val(d.onChange(f.values))}})}}};(function(d){var f={put:function(h,g){(g||window).location.hash=this.encoder(h)},get:function(j){var h=((j||window).location.hash).replace(/^#/,"");try{return d.browser.mozilla?h:decodeURIComponent(h)}catch(g){return h}},encoder:encodeURIComponent};var c={id:"__jQuery_history",init:function(){var g='<iframe id="'+this.id+'" style="display:none" src="javascript:false;" />';d("body").prepend(g);return this},_document:function(){return d("#"+this.id)[0].contentWindow.document},put:function(h){var g=this._document();g.open();g.close();f.put(h,g)},get:function(){return f.get(this._document())}};function e(h){h=d.extend({unescape:false},h||{});f.encoder=j(h.unescape);function j(k){if(k===true){return function(l){return l}}if(typeof k=="string"&&(k=g(k.split("")))||typeof k=="function"){return function(l){return k(encodeURIComponent(l))}}return encodeURIComponent}function g(l){var k=new RegExp(d.map(l,encodeURIComponent).join("|"),"ig");return function(m){return m.replace(k,decodeURIComponent)}}}var b={};b.base={callback:undefined,type:undefined,check:function(){},load:function(g){},init:function(h,g){e(g);a.callback=h;a._options=g;a._init()},_init:function(){},_options:{}};b.timer={_appState:undefined,_init:function(){var g=f.get();a._appState=g;a.callback(g);setInterval(a.check,100)},check:function(){var g=f.get();if(g!=a._appState){a._appState=g;a.callback(g)}},load:function(g){if(g!=a._appState){f.put(g);a._appState=g;a.callback(g)}}};b.iframeTimer={_appState:undefined,_init:function(){var g=f.get();a._appState=g;c.init().put(g);a.callback(g);setInterval(a.check,100)},check:function(){var h=c.get(),g=f.get();if(g!=h){if(g==a._appState){a._appState=h;f.put(h);a.callback(h)}else{a._appState=g;c.put(g);a.callback(g)}}},load:function(g){if(g!=a._appState){f.put(g);c.put(g);a._appState=g;a.callback(g)}}};b.hashchangeEvent={_init:function(){a.callback(f.get());d(window).bind("hashchange",a.check)},check:function(){a.callback(f.get())},load:function(g){f.put(g)}};var a=d.extend({},b.base);if(d.browser.msie&&(d.browser.version<8||document.documentMode<8)){a.type="iframeTimer"}else{if("onhashchange" in window){a.type="hashchangeEvent"}else{a.type="timer"}}d.extend(a,b[a.type]);d.history=a})(jQuery);(function(d){d.timeago=function(g){if(g instanceof Date){return a(g)}else{if(typeof g==="string"){return a(d.timeago.parse(g))}else{return a(d.timeago.datetime(g))}}};var f=d.timeago;d.extend(d.timeago,{settings:{refreshMillis:60000,allowFuture:false,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"a minute",minute:"a minute",minutes:"%d minutes",hour:"an hour",hours:"%d hours",day:"a day",days:"%d days",month:"a month",months:"%d months",year:"a year",years:"%d years",numbers:[]}},inWords:function(m){var n=this.settings.strings;var j=n.prefixAgo;var s=n.suffixAgo;if(this.settings.allowFuture){if(m<0){j=n.prefixFromNow;s=n.suffixFromNow}m=Math.abs(m)}var p=m/1000;var g=p/60;var o=g/60;var q=o/24;var k=q/365;function h(t,v){var u=d.isFunction(t)?t(v,m):t;var w=(n.numbers&&n.numbers[v])||v;return u.replace(/%d/i,w)}var l=p<45&&h(n.seconds,Math.round(p))||p<90&&h(n.minute,1)||g<45&&h(n.minutes,Math.round(g))||g<90&&h(n.hour,1)||o<24&&h(n.hours,Math.round(o))||o<48&&h(n.day,1)||q<30&&h(n.days,Math.floor(q))||q<60&&h(n.month,1)||q<365&&h(n.months,Math.floor(q/30))||k<2&&h(n.year,1)||h(n.years,Math.floor(k));return d.trim([j,l,s].join(" "))},parse:function(h){var g=d.trim(h);g=g.replace(/\.\d\d\d+/,"");g=g.replace(/-/,"/").replace(/-/,"/");g=g.replace(/T/," ").replace(/Z/," UTC");g=g.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2");return new Date(g)},datetime:function(h){var j=d(h).get(0).tagName.toLowerCase()==="time";var g=j?d(h).attr("datetime"):d(h).attr("title");return f.parse(g)}});d.fn.timeago=function(){var h=this;h.each(c);var g=f.settings;if(g.refreshMillis>0){setInterval(function(){h.each(c)},g.refreshMillis)}return h};function c(){var g=b(this);if(!isNaN(g.datetime)){d(this).text(a(g.datetime))}return this}function b(g){g=d(g);if(!g.data("timeago")){g.data("timeago",{datetime:f.datetime(g)});var h=d.trim(g.text());if(h.length>0){g.attr("title",h)}}return g.data("timeago")}function a(g){return f.inWords(e(g))}function e(g){return(new Date().getTime()-g.getTime())}document.createElement("abbr");document.createElement("time")}(jQuery));Framework.Services={jsonpCallbacks:[],defaultGeocode:{area:"Manhattan",city:"New York",country:"USA",latlong:"40.7687736,-73.9542591",state:"NY",zipcode:"10021"},add_activity:function(b,a){this._makeAjaxCall({url:"/add",data:b,type:"post",success:function(c){a.callback(parseInt(c))}},a)},logout:function(a){this.makeJsonpCall(Framework.SERVICE_GAE+"logout",a)},login:function(b,a){this.makeJsonpCall(Framework.SERVICE_GAE+"login?"+Framework.Utils.get_as_url_params(b),a)},join:function(b,a){this.makeJsonpCall(Framework.SERVICE_GAE+"join?"+Framework.Utils.get_as_url_params(b),a)},update_login:function(b,a){this.makeJsonpCall(Framework.SERVICE_GAE+"updatelogin?"+Framework.Utils.get_as_url_params(b),a)},reset_password:function(b,a){this.makeJsonpCall(Framework.SERVICE_GAE+"resetpass?"+Framework.Utils.get_as_url_params(b),a)},signinout_anonymously:function(b,a){this.makeJsonpCall(Framework.SERVICE_GAE+"anonysign?"+Framework.Utils.get_as_url_params(b),a)},get_login_details:function(a){this.makeJsonpCall(Framework.SERVICE_GAE+"getuser",a)},get_users:function(b,a){this.makeJsonpCall(Framework.SERVICE_GAE+"getusers?"+Framework.Utils.get_as_url_params(b),a)},get_event:function(b,a){this.makeJsonpCall(Framework.SERVICE_GAE+"getevent?"+Framework.Utils.get_as_url_params(b),a)},get_events:function(b,a){this.makeJsonpCall(Framework.SERVICE_GAE+"search?"+Framework.Utils.get_as_url_params(b),a)},send_message:function(b,a){a=a||{};this._makeAjaxCall({url:"/sendmsg",data:b,type:"post",success:function(c){if(a.callback){a.callback(c)}}},a)},add_message:function(b,a){this.makeJsonpCall(Framework.SERVICE_GAE+"addmsg?"+Framework.Utils.get_as_url_params(b),a)},get_messages:function(b,a){this.makeJsonpCall(Framework.SERVICE_GAE+"getmsgs?eventid="+b,a)},get_geocode:function(a){this.makeJsonpCall(Framework.SERVICE_URL+"geolocation/geobytes",{callback:function(b){var c={};if(!b){c=Framework.Services.defaultGeocode}else{c.zipcode="";c.area=b.region||b.city;c.city=b.city;c.state=b.regioncode;c.country=b.country;c.latlong=b.latitude+","+b.longitude;Framework.Services.defaultGeocode=c}a.callback(c)}})},get_ipaddress:function(a){this.makeJsonpCall("http://jsonip.appspot.com/",{callback:function(b){a.callback(b.ip)}})},get_geocode_details:function(c,a){if(!c){a.callback(this.defaultGeocode);return}var b=function(e){var f={};f.zipcode=Framework.Utils.findProperty("PostalCodeNumber",e)||"";f.area=Framework.Utils.findProperty("formatted_address",e)||c;f.city="";f.state="";f.country="";var d=Framework.Utils.findProperty("location",e);if(!d){Framework.Utils.error("no geocode details");f=Framework.Services.defaultGeocode}else{f.latlong=d.lat+","+d.lng}a.callback(f)};Framework.Services.makeJsonpCall(Framework.SERVICE_URL+"proxy/getjson?path="+encodeURIComponent("http://maps.googleapis.com/maps/api/geocode/json?sensor=false&address="+encodeURIComponent(c)),{callback:b})},get_file:function(b,a){this._makeAjaxCall({url:b,success:a.callback},{})},makeYqlCall:function(b,a){a.format=a.format||"json";Framework.Services.makeJsonpCall("http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(b)+"&format="+a.format+"&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys",a)},makeJsonpCall:function(b,a){a=a||{};var d={};d.url=b;d.dataType="jsonp";d.jsonpCallback="Framework.Services.jsonpCallbacks["+(this.jsonpCallbacks.length)+"]";var c;this.jsonpCallbacks.push(function(f){clearTimeout(c);try{if(a.callback){a.callback(f)}}catch(g){Framework.Utils.error(g);if(a.onFailure){a.onFailure()}}});c=setTimeout(function(){if(a.onFailure){a.onFailure()}},5000);this._makeAjaxCall(d,a)},_makeAjaxCall:function(b,a){b.error=function(d,c){Framework.Utils.error(c+","+b.url+","+Framework.Utils.get_as_url_params(b.data));if(a.onFailure){a.onFailure()}};$.ajax(b)}};Framework.Utils={makeButton:function(a){a.addClass("ui-button").addClass("ui-corner-all");a.hover(function(){jQuery(this).addClass("ui-state-hover")},function(){jQuery(this).removeClass("ui-state-hover")});return a},cache:{},tmpl:function(c,b){var a=!/\W/.test(c)?this.cache[c]=this.cache[c]||this.tmpl(document.getElementById(c).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+c.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return b?a(b):a},random_num:function(b,a){b=b?b:0;a=a?a:9999999;return b+Math.floor(Math.random()*(b+a-1))},store_state:function(a){$.cookie("state",$.toJSON(a))},get_state:function(a){var b=$.cookie("state");if(!a){$.cookie("state",null)}return $.evalJSON(b)},delete_all_cookies:function(){var f=document.cookie.split(";");for(var a=0;a<f.length;a++){var b=f[a].indexOf("=");var d=b>-1?f[a].substr(0,b):f[a];document.cookie=d+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}},get_as_url_params:function(e,b){if(!e){return""}var a=[];for(var c in e){if(!c||jQuery.trim(c)==""||c.match(/__eht/)){continue}var d=typeof(e[c])=="object"?JSON.stringify(e[c]):e[c];if(b){a.push(c+"="+d)}else{a.push(c+"="+encodeURIComponent(d))}}return a.join("&")},go_to_url:function(b,c){var a=Framework.SITE_URL+b;a=c?a+"#"+this.get_as_url_params(c):a;window.location=a},get_age:function(a){return Math.floor((Date.today()-Date.parse(a,"yyyy-mm-dd"))/(Date.today()-Date.today().addYears(-1)))},parseUrlCache:{},parseUrl:function(b){var c=/^((\w+):)?(\/\/((\w+)?(:(\w+))?@)?([^\/\?:]+)(:(\d+))?)?(\/?([^\/\?#][^\?#]*)?)?(\?([^#]+))?(#(.*))?/;b=b||window.location.href;var d;if(!this.parseUrlCache[b]){var a=b.match(c);this.parseUrlCache[b]={url:a[0],protocol:a[2],username:a[5],password:a[7],host:a[8]||"",port:a[10],pathname:a[11]||"",querystring:a[14]||"",fragment:a[16]||""}}d=this.parseUrlCache[b];d.param=function(e){return d.hashParam(e)||d.searchParam(e)};d.searchParam=function(f){var e=new RegExp("[?&]"+f+"=([^&]*)?","i").exec("?"+this.querystring);return !e?null:e[1]};d.hashParam=function(f){var e=new RegExp("[#&]"+f+"=([^&]*)?","i").exec("#"+this.fragment);return !e||typeof(e[1])!="string"?null:decodeURIComponent(e[1])};d.getAllParams=function(){var e=d.getAllSearchParams();jQuery.extend(e,d.getAllHashParams());return e};d.getAllHashParams=function(){var g=this.fragment.split("&");var f={};for(var e=0;e<g.length;e++){var h=g[e].split("=");f[h[0]]=decodeURIComponent(h[1])}return f};d.getAllSearchParams=function(){var f=this.querystring.split("&");var h={};for(var e=0;e<f.length;e++){var g=f[e].split("=");h[g[0]]=decodeURIComponent(g[1])}return h};return d},updateUrl:function(g,b){b=b||{};var e=Framework.Utils.parseUrl();var d=e.fragment;for(key in g){var c=new RegExp(key+"=.*?($|&)");if(d.match(c)){if(g[key]===null){d=d.replace(new RegExp("&?"+key+"=[^$&]*"),"")}else{d=d.replace(c,key+"="+encodeURIComponent(g[key])+"$1")}}else{if(g[key]!==null){var f=d.length===0?"":"&";d+=f+key+"="+encodeURIComponent(g[key])}}}if(e.fragment!=d){var a=e.url.split("#")[0]+"#"+d;window.location.href=a}},geolocate:function(c){var a=function(d){Framework.Analytics.trackEvent("geolocation","error",d)};var b=function(e){var d={latitude:e.coords.latitude||e.coords.Latitude,longitude:e.coords.longitude||e.coords.Longitude};Framework.Services.get_geocode_details((d.latitude||d.Latitude)+","+(d.longitude||d.longitude),{callback:function(f){Framework.Utils.geocode(f);c(f)}})};navigator.geolocation.getCurrentPosition(b,a,{timeout:10000,maximumAge:60000})},geocode_stored:null,geocode:function(a){if(typeof(a)=="undefined"){a=$.evalJSON($.cookie("geocode"));if(!a){Framework.Analytics.trackEvent("geolocation","error","no geocode");a=this.geocode_stored||Framework.Services.defaultGeocode}return a}else{$.cookie("geocode",$.toJSON(a));this.geocode_stored=a}},error:function(b,a){b=typeof(b)=="string"?new Error(b):b;if(window.ExceptionHub){ExceptionHub.logStackTrace(b).upload()}console.error(b)},capitaliseFirstLetter:function(a){if(typeof(a)!=="string"&&!isNaN(a.length)){for(var b=0;b<a.length;b++){a[b]=a[b].charAt(0).toUpperCase()+a[b].slice(1)}return a.join(", ")}else{a=a||" ";return a.charAt(0).toUpperCase()+a.slice(1)}},shorten:function(a,b){b=b||10;return(a&&a.length>b)?a.substring(0,b-3)+"...":a},strip_stopwords:function(a){var b=[];for(var c in Framework.Constants.STOPWORDS){b.push("\\b"+c+"\\b")}return a.replace(new RegExp(b.join("|"),"gim"),"").replace(/,\s*,/gim,",").replace(/(^,)|(,$)/gim,"")},findProperty:function(a,e){var d;if(e&&e.constructor==Array){for(var c=0;c<e.length;c++){d=this.findProperty(a,e[c]);if(typeof(d)!=="undefined"){break}}}else{if(typeof(e)=="object"){for(var b in e){if(b==a){d=e[b];break}else{d=this.findProperty(a,e[b]);if(typeof(d)!=="undefined"){break}}}}}return d},F:function(){},shuffle:function(b){if(b&&b.length>1){for(var c,a,d=b.length;d;c=parseInt(Math.random()*d),a=b[--d],b[d]=b[c],b[c]=a){}}return b},ahoCorasick:function(g,c){var f=g;var e="";var b=c.split("");var a=0;while(1){for(i=a;i<b.length;i++){var d=f.hasChild(b[i]);if(d){e+=b[i];f=d;if(g.getWordCount(e)!=0){return true}}else{f=g;i=i-e.length;e=""}}if(e==""){return false}else{f=g;a=i-e.length+1;e=""}}},get_share_link:function(b){var a=Framework.SITE_URL+"#eventid="+b.id;return'<a href="'+a+'">Link to this</a>'},get_datetime_formatted:function(c){var a=new Date(c);var b={};if(a.toString("htt")=="0AM"){b.time=""}else{b.time=a.toString("htt")}b.day=a.toString("d");b.dayofweek=a.toString("ddd").toLowerCase();return b},get_datetime_formatted_email:function(a){return new Date(a).toString("dddd, MMMM d, yyyy h:mm tt")},parseXml:function(b){if(window.ActiveXObject){var a=new ActiveXObject("Microsoft.XMLDOM");a.loadXML(b);return a}else{if(window.DOMParser){return(new DOMParser).parseFromString(b,"text/xml")}else{return""}}},inArray:function(c,b){if(!b||typeof(b.length)=="undefined"){return false}for(var a=0;a<b.length;a++){if(c instanceof RegExp&&b[a].match(c)){return true}else{if(b[a] instanceof RegExp&&c.match(b[a])){return true}else{if(b[a]==c){return true}}}}return false},in_newyork:function(a,b){if(Framework.Utils.inArray(parseInt(a),[39,40])&&Framework.Utils.inArray(parseInt(b),[-73,-74])){return true}else{return false}},get_time_12am:function(a){a=a||new Date();if(typeof(a)=="number"){a=new Date(a)}return Date.parseExact(a.toString("yyyy/MM/dd"),"yyyy/MM/dd").getTime()},get_formatted_users:function(c){var a=function(d){if(!d.pic){d.pic=Framework.SITE_URL+"images/anonymous.jpg"}if(!d.url){d.url="http://www.facebook.com/profile.php?id=100002119287850"}if(!d.name){d.name="Anonymous"}d.name=d.name.split(" ")[0];if(!d.activities){d.activities=[]}return d};if(!c.length){return a(c)}for(var b=0;b<c.length;b++){c[b]=a(c[b])}return c},chompSlash:function(a){return a.replace(/[\/\\]*$/,"")},inFacebook:function(){return window!=window.top?true:false}};Framework.Facebook={callbacks_afterlogin:[],initialized:false,user:null,friends:null,init:function(a){if(!Framework.Facebook.initialized){jQuery.getScript("http://connect.facebook.net/en_US/all.js",function(){var b=function(){if(Framework.Facebook.initialized){if(a){a()}}else{setTimeout(b,10)}};b()})}},loginCheck:function(b,a){if(!Framework.Facebook.initialized){Framework.Facebook.init(function(){Framework.Facebook.loginCheck(b,a)});return}if(Framework.Facebook.user){b()}else{if(a){FB.login(function(c){Framework.Facebook.handleSessionResponse(c,b)},{perms:"user_about_me,user_activities,user_interests,user_likes,email,friends_activities,friends_interests,publish_stream"})}else{FB.getLoginStatus(function(c){Framework.Facebook.handleSessionResponse(c,b)})}}},logout:function(){FB.logout(Framework.Facebook.handleSessionResponse)},get_friends:function(a){Framework.Facebook.loginCheck(function(){if(Framework.Facebook.friends){a(Framework.Facebook.friends)}else{if(Framework.Facebook.user){FB.api({method:"fql.query",query:"SELECT uid, name, pic_square, sex, activities, interests FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = me())"},function(b){Framework.Facebook.friends=b;a(Framework.Facebook.friends)})}}})},app_invite:function(a){Framework.Analytics.trackAction("invite","facebook-app","prompt");FB.ui({method:"apprequests",message:Framework.Facebook.user.name+" wants to share activities & hobbies with you.",filters:["app_non_users"],data:"from="+Framework.Facebook.user.name},function(b){if(b&&b.request_ids){Framework.Analytics.trackAction("invite","facebook-app","sent")}else{Framework.Analytics.trackAction("invite","facebook-app","cancel")}if(a){a()}})},post_stream:function(b,a,c){Framework.Analytics.trackAction("invite","facebook-stream","prompt");FB.ui({method:"stream.publish",message:b,action_links:[{text:"Join me",href:a}],user_message_prompt:"Let your friends know about OpenCirclez"},function(d){if(d&&d.post_id){Framework.Analytics.trackAction("invite","facebook-stream","sent")}else{Framework.Analytics.trackAction("invite","facebook-stream","cancel")}if(c){c()}})},handleSessionResponse:function(a,b){if(!a.session){Framework.Facebook.user=null;if(b){b()}return}FB.api({method:"fql.query",query:"SELECT uid, name, sex, email, pic, activities, interests, about_me FROM user WHERE uid="+FB.getSession().uid},function(c){Framework.Facebook.user=c[0];Framework.Facebook.user.activities=Framework.Facebook.user.activities||"";Framework.Facebook.user.interests=Framework.Facebook.user.interests||"";Framework.Facebook.user.keywords=Framework.Facebook.user.interests+","+Framework.Facebook.user.activities;if(Framework.Facebook.user.keywords==","){Framework.Facebook.user.keywords=""}if(b){b()}})}};window.fbAsyncInit=function(){var a;if(window.location.href.match(/(open-circles)|(opencirclez)/)){a="c8587ca6fcf64d9c51e6b15a3c646cfe"}else{if(window.location.href.match(/rpmdesign/)){a="e3135f6cdad27a6ae433ecb92811a6e0"}else{a="cd833b5b32aaff3cee1d10bf99cc3eb1"}}FB.init({appId:a,status:true,cookie:true,xfbml:true});if(window.location!=window.parent.location){FB.Canvas.setAutoResize()}FB.getLoginStatus(Framework.Facebook.handleSessionResponse);Framework.Facebook.initialized=true};var qq=qq||{};qq.extend=function(b,a){for(var c in a){b[c]=a[c]}};qq.indexOf=function(b,c,d){if(b.indexOf){return b.indexOf(c,d)}d=d||0;var a=b.length;if(d<0){d+=a}for(;d<a;d++){if(d in b&&b[d]===c){return d}}return -1};qq.getUniqueId=(function(){var a=0;return function(){return a++}})();qq.attach=function(a,c,b){if(a.addEventListener){a.addEventListener(c,b,false)}else{if(a.attachEvent){a.attachEvent("on"+c,b)}}};qq.detach=function(a,c,b){if(a.removeEventListener){a.removeEventListener(c,b,false)}else{if(a.attachEvent){a.detachEvent("on"+c,b)}}};qq.preventDefault=function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};qq.insertBefore=function(d,c){c.parentNode.insertBefore(d,c)};qq.remove=function(a){a.parentNode.removeChild(a)};qq.contains=function(b,a){if(b==a){return true}if(b.contains){return b.contains(a)}else{return !!(a.compareDocumentPosition(b)&8)}};qq.toElement=(function(){var a=document.createElement("div");return function(c){a.innerHTML=c;var b=a.firstChild;a.removeChild(b);return b}})();qq.css=function(a,b){if(b.opacity!=null){if(typeof a.style.opacity!="string"&&typeof(a.filters)!="undefined"){b.filter="alpha(opacity="+Math.round(100*b.opacity)+")"}}qq.extend(a.style,b)};qq.hasClass=function(b,a){var c=new RegExp("(^| )"+a+"( |$)");return c.test(b.className)};qq.addClass=function(b,a){if(!qq.hasClass(b,a)){b.className+=" "+a}};qq.removeClass=function(b,a){var c=new RegExp("(^| )"+a+"( |$)");b.className=b.className.replace(c," ").replace(/^\s+|\s+$/g,"")};qq.setText=function(a,b){a.innerText=b;a.textContent=b};qq.children=function(b){var a=[],c=b.firstChild;while(c){if(c.nodeType==1){a.push(c)}c=c.nextSibling}return a};qq.getByClass=function(d,e){if(d.querySelectorAll){return d.querySelectorAll("."+e)}var b=[];var f=d.getElementsByTagName("*");var a=f.length;for(var c=0;c<a;c++){if(qq.hasClass(f[c],e)){b.push(f[c])}}return b};qq.obj2url=function(f,b,h){var g=[],d="&",e=function(k,j){var l=b?(/\[\]$/.test(b))?b:b+"["+j+"]":j;if((l!="undefined")&&(j!="undefined")){g.push((typeof k==="object")?qq.obj2url(k,l,true):(Object.prototype.toString.call(k)==="[object Function]")?encodeURIComponent(l)+"="+encodeURIComponent(k()):encodeURIComponent(l)+"="+encodeURIComponent(k))}};if(!h&&b){d=(/\?/.test(b))?(/\?$/.test(b))?"":"&":"?";g.push(b);g.push(qq.obj2url(f))}else{if((Object.prototype.toString.call(f)==="[object Array]")&&(typeof f!="undefined")){for(var c=0,a=f.length;c<a;++c){e(f[c],c)}}else{if((typeof f!="undefined")&&(f!==null)&&(typeof f==="object")){for(var c in f){e(f[c],c)}}else{g.push(encodeURIComponent(b)+"="+encodeURIComponent(f))}}}return g.join(d).replace(/^&/,"").replace(/%20/g,"+")};var qq=qq||{};qq.FileUploaderBasic=function(a){this._options={debug:false,action:"/server/upload",params:{},button:null,multiple:true,maxConnections:3,allowedExtensions:[],sizeLimit:0,minSizeLimit:0,onSubmit:function(c,b){},onProgress:function(e,d,b,c){},onComplete:function(d,c,b){},onCancel:function(c,b){},messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},showMessage:function(b){alert(b)}};qq.extend(this._options,a);this._filesInProgress=0;this._handler=this._createUploadHandler();if(this._options.button){this._button=this._createUploadButton(this._options.button)}this._preventLeaveInProgress()};qq.FileUploaderBasic.prototype={setParams:function(a){this._options.params=a},getInProgress:function(){return this._filesInProgress},_createUploadButton:function(b){var a=this;return new qq.UploadButton({element:b,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),onChange:function(c){a._onInputChange(c)}})},_createUploadHandler:function(){var a=this,c;if(qq.UploadHandlerXhr.isSupported()){c="UploadHandlerXhr"}else{c="UploadHandlerForm"}var b=new qq[c]({debug:this._options.debug,action:this._options.action,maxConnections:this._options.maxConnections,onProgress:function(g,f,d,e){a._onProgress(g,f,d,e);a._options.onProgress(g,f,d,e)},onComplete:function(f,e,d){a._onComplete(f,e,d);a._options.onComplete(f,e,d)},onCancel:function(e,d){a._onCancel(e,d);a._options.onCancel(e,d)}});return b},_preventLeaveInProgress:function(){var a=this;qq.attach(window,"beforeunload",function(b){if(!a._filesInProgress){return}var b=b||window.event;b.returnValue=a._options.messages.onLeave;return a._options.messages.onLeave})},_onSubmit:function(b,a){this._filesInProgress++},_onProgress:function(d,c,a,b){},_onComplete:function(c,b,a){this._filesInProgress--;if(a.error){this._options.showMessage(a.error)}},_onCancel:function(b,a){this._filesInProgress--},_onInputChange:function(a){if(this._handler instanceof qq.UploadHandlerXhr){this._uploadFileList(a.files)}else{if(this._validateFile(a)){this._uploadFile(a)}}this._button.reset()},_uploadFileList:function(b){for(var a=0;a<b.length;a++){if(!this._validateFile(b[a])){return}}for(var a=0;a<b.length;a++){this._uploadFile(b[a])}},_uploadFile:function(a){var c=this._handler.add(a);var b=this._handler.getName(c);if(this._options.onSubmit(c,b)!==false){this._onSubmit(c,b);this._handler.upload(c,this._options.params)}},_validateFile:function(c){var a,b;if(c.value){a=c.value.replace(/.*(\/|\\)/,"")}else{a=c.fileName!=null?c.fileName:c.name;b=c.fileSize!=null?c.fileSize:c.size}if(!this._isAllowedExtension(a)){this._error("typeError",a);return false}else{if(b===0){this._error("emptyError",a);return false}else{if(b&&this._options.sizeLimit&&b>this._options.sizeLimit){this._error("sizeError",a);return false}else{if(b&&b<this._options.minSizeLimit){this._error("minSizeError",a);return false}}}}return true},_error:function(c,d){var b=this._options.messages[c];function a(e,f){b=b.replace(e,f)}a("{file}",this._formatFileName(d));a("{extensions}",this._options.allowedExtensions.join(", "));a("{sizeLimit}",this._formatSize(this._options.sizeLimit));a("{minSizeLimit}",this._formatSize(this._options.minSizeLimit));this._options.showMessage(b)},_formatFileName:function(a){if(a.length>33){a=a.slice(0,19)+"..."+a.slice(-13)}return a},_isAllowedExtension:function(d){var b=(-1!==d.indexOf("."))?d.replace(/.*[.]/,"").toLowerCase():"";var c=this._options.allowedExtensions;if(!c.length){return true}for(var a=0;a<c.length;a++){if(c[a].toLowerCase()==b){return true}}return false},_formatSize:function(a){var b=-1;do{a=a/1024;b++}while(a>99);return Math.max(a,0.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][b]}};qq.FileUploader=function(a){qq.FileUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,template:'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>Drop files here to upload</span></div><div class="qq-upload-button">Upload a file</div><ul class="qq-upload-list"></ul></div>',fileTemplate:'<li><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Cancel</a><span class="qq-upload-failed-text">Failed</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail"}});qq.extend(this._options,a);this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");this._classes=this._options.classes;this._button=this._createUploadButton(this._find(this._element,"button"));this._bindCancelEvent();this._setupDragDrop()};qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype);qq.extend(qq.FileUploader.prototype,{_find:function(c,b){var a=qq.getByClass(c,this._options.classes[b])[0];if(!a){throw new Error("element not found "+b)}return a},_setupDragDrop:function(){var b=this,c=this._find(this._element,"drop");var a=new qq.UploadDropZone({element:c,onEnter:function(d){qq.addClass(c,b._classes.dropActive);d.stopPropagation()},onLeave:function(d){d.stopPropagation()},onLeaveNotDescendants:function(d){qq.removeClass(c,b._classes.dropActive)},onDrop:function(d){c.style.display="none";qq.removeClass(c,b._classes.dropActive);b._uploadFileList(d.dataTransfer.files)}});c.style.display="none";qq.attach(document,"dragenter",function(d){if(!a._isValidFileDrag(d)){return}c.style.display="block"});qq.attach(document,"dragleave",function(f){if(!a._isValidFileDrag(f)){return}var d=document.elementFromPoint(f.clientX,f.clientY);if(!d||d.nodeName=="HTML"){c.style.display="none"}})},_onSubmit:function(b,a){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(b,a)},_onProgress:function(g,f,a,d){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var c=this._getItemByFileId(g);var b=this._find(c,"size");b.style.display="inline";var e;if(a!=d){e=Math.round(a/d*100)+"% from "+this._formatSize(d)}else{e=this._formatSize(d)}qq.setText(b,e)},_onComplete:function(d,c,a){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var b=this._getItemByFileId(d);qq.remove(this._find(b,"cancel"));qq.remove(this._find(b,"spinner"));if(a.success){qq.addClass(b,this._classes.success)}else{qq.addClass(b,this._classes.fail)}},_addToList:function(d,c){var a=qq.toElement(this._options.fileTemplate);a.qqFileId=d;var b=this._find(a,"file");qq.setText(b,this._formatFileName(c));this._find(a,"size").style.display="none";this._listElement.appendChild(a)},_getItemByFileId:function(b){var a=this._listElement.firstChild;while(a){if(a.qqFileId==b){return a}a=a.nextSibling}},_bindCancelEvent:function(){var a=this,b=this._listElement;qq.attach(b,"click",function(f){f=f||window.event;var d=f.target||f.srcElement;if(qq.hasClass(d,a._classes.cancel)){qq.preventDefault(f);var c=d.parentNode;a._handler.cancel(c.qqFileId);qq.remove(c)}})}});qq.UploadDropZone=function(a){this._options={element:null,onEnter:function(b){},onLeave:function(b){},onLeaveNotDescendants:function(b){},onDrop:function(b){}};qq.extend(this._options,a);this._element=this._options.element;this._disableDropOutside();this._attachEvents()};qq.UploadDropZone.prototype={_disableDropOutside:function(a){if(!qq.UploadDropZone.dropOutsideDisabled){qq.attach(document,"dragover",function(b){if(b.dataTransfer){b.dataTransfer.dropEffect="none";b.preventDefault()}});qq.UploadDropZone.dropOutsideDisabled=true}},_attachEvents:function(){var a=this;qq.attach(a._element,"dragover",function(c){if(!a._isValidFileDrag(c)){return}var b=c.dataTransfer.effectAllowed;if(b=="move"||b=="linkMove"){c.dataTransfer.dropEffect="move"}else{c.dataTransfer.dropEffect="copy"}c.stopPropagation();c.preventDefault()});qq.attach(a._element,"dragenter",function(b){if(!a._isValidFileDrag(b)){return}a._options.onEnter(b)});qq.attach(a._element,"dragleave",function(c){if(!a._isValidFileDrag(c)){return}a._options.onLeave(c);var b=document.elementFromPoint(c.clientX,c.clientY);if(qq.contains(this,b)){return}a._options.onLeaveNotDescendants(c)});qq.attach(a._element,"drop",function(b){if(!a._isValidFileDrag(b)){return}b.preventDefault();a._options.onDrop(b)})},_isValidFileDrag:function(c){var b=c.dataTransfer,a=navigator.userAgent.indexOf("AppleWebKit")>-1;return b&&b.effectAllowed!="none"&&(b.files||(!a&&b.types.contains&&b.types.contains("Files")))}};qq.UploadButton=function(a){this._options={element:null,multiple:false,name:"file",onChange:function(b){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(this._options,a);this._element=this._options.element;qq.css(this._element,{position:"relative",overflow:"hidden",direction:"ltr"});this._input=this._createInput()};qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){if(this._input.parentNode){qq.remove(this._input)}qq.removeClass(this._element,this._options.focusClass);this._input=this._createInput()},_createInput:function(){var b=document.createElement("input");if(this._options.multiple){b.setAttribute("multiple","multiple")}b.setAttribute("type","file");b.setAttribute("name",this._options.name);qq.css(b,{position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0});this._element.appendChild(b);var a=this;qq.attach(b,"change",function(){a._options.onChange(b)});qq.attach(b,"mouseover",function(){qq.addClass(a._element,a._options.hoverClass)});qq.attach(b,"mouseout",function(){qq.removeClass(a._element,a._options.hoverClass)});qq.attach(b,"focus",function(){qq.addClass(a._element,a._options.focusClass)});qq.attach(b,"blur",function(){qq.removeClass(a._element,a._options.focusClass)});if(window.attachEvent){b.setAttribute("tabIndex","-1")}return b}};qq.UploadHandlerAbstract=function(a){this._options={debug:false,action:"/upload.php",maxConnections:999,onProgress:function(e,d,b,c){},onComplete:function(d,c,b){},onCancel:function(c,b){}};qq.extend(this._options,a);this._queue=[];this._params=[]};qq.UploadHandlerAbstract.prototype={log:function(a){if(this._options.debug&&window.console){console.log("[uploader] "+a)}},add:function(a){},upload:function(d,b){var a=this._queue.push(d);var c={};qq.extend(c,b);this._params[d]=c;if(a<=this._options.maxConnections){this._upload(d,this._params[d])}},cancel:function(a){this._cancel(a);this._dequeue(a)},cancelAll:function(){for(var a=0;a<this._queue.length;a++){this._cancel(this._queue[a])}this._queue=[]},getName:function(a){},getSize:function(a){},getQueue:function(){return this._queue},_upload:function(a){},_cancel:function(a){},_dequeue:function(d){var b=qq.indexOf(this._queue,d);this._queue.splice(b,1);var a=this._options.maxConnections;if(this._queue.length>=a){var c=this._queue[a-1];this._upload(c,this._params[c])}}};qq.UploadHandlerForm=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._inputs={}};qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerForm.prototype,{add:function(a){a.setAttribute("name","qqfile");var b="qq-upload-handler-iframe"+qq.getUniqueId();this._inputs[b]=a;if(a.parentNode){qq.remove(a)}return b},getName:function(a){return this._inputs[a].value.replace(/.*(\/|\\)/,"")},_cancel:function(b){this._options.onCancel(b,this.getName(b));delete this._inputs[b];var a=document.getElementById(b);if(a){a.setAttribute("src","javascript:false;");qq.remove(a)}},_upload:function(g,e){var b=this._inputs[g];if(!b){throw new Error("file with passed id was not added, or already uploaded or cancelled")}var f=this.getName(g);var c=this._createIframe(g);var d=this._createForm(c,e);d.appendChild(b);var a=this;this._attachLoadEvent(c,function(){a.log("iframe loaded");var h=a._getIframeContentJSON(c);a._options.onComplete(g,f,h);a._dequeue(g);delete a._inputs[g];setTimeout(function(){qq.remove(c)},1)});d.submit();qq.remove(d);return g},_attachLoadEvent:function(a,b){qq.attach(a,"load",function(){if(!a.parentNode){return}if(a.contentDocument&&a.contentDocument.body&&a.contentDocument.body.innerHTML=="false"){return}b()})},_getIframeContentJSON:function(iframe){var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;this.log("converting iframe's innerHTML to JSON");this.log("innerHTML = "+doc.body.innerHTML);try{response=eval("("+doc.body.innerHTML+")")}catch(err){response={}}return response},_createIframe:function(b){var a=qq.toElement('<iframe src="javascript:false;" name="'+b+'" />');a.setAttribute("id",b);a.style.display="none";document.body.appendChild(a);return a},_createForm:function(a,c){var b=qq.toElement('<form method="post" enctype="multipart/form-data"></form>');var d=qq.obj2url(c,this._options.action);b.setAttribute("action",d);b.setAttribute("target",a.name);b.style.display="none";document.body.appendChild(b);return b}});qq.UploadHandlerXhr=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[]};qq.UploadHandlerXhr.isSupported=function(){var a=document.createElement("input");a.type="file";return("multiple" in a&&typeof File!="undefined"&&typeof(new XMLHttpRequest()).upload!="undefined")};qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerXhr.prototype,{add:function(a){if(!(a instanceof File)){throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)")}return this._files.push(a)-1},getName:function(b){var a=this._files[b];return a.fileName!=null?a.fileName:a.name},getSize:function(b){var a=this._files[b];return a.fileSize!=null?a.fileSize:a.size},getLoaded:function(a){return this._loaded[a]||0},_upload:function(h,f){var d=this._files[h],b=this.getName(h),c=this.getSize(h);this._loaded[h]=0;var e=this._xhrs[h]=new XMLHttpRequest();var a=this;e.upload.onprogress=function(j){if(j.lengthComputable){a._loaded[h]=j.loaded;a._options.onProgress(h,b,j.loaded,j.total)}};e.onreadystatechange=function(){if(e.readyState==4){a._onComplete(h,e)}};f=f||{};f.qqfile=b;var g=qq.obj2url(f,this._options.action);e.open("POST",g,true);e.setRequestHeader("X-Requested-With","XMLHttpRequest");e.setRequestHeader("X-File-Name",encodeURIComponent(b));e.setRequestHeader("Content-Type","application/octet-stream");e.send(d)},_onComplete:function(id,xhr){if(!this._files[id]){return}var name=this.getName(id);var size=this.getSize(id);this._options.onProgress(id,name,size,size);if(xhr.status==200){this.log("xhr - server response received");this.log("responseText = "+xhr.responseText);var response;try{response=eval("("+xhr.responseText+")")}catch(err){response={}}this._options.onComplete(id,name,response)}else{this._options.onComplete(id,name,{})}this._files[id]=null;this._xhrs[id]=null;this._dequeue(id)},_cancel:function(a){this._options.onCancel(a,this.getName(a));this._files[a]=null;if(this._xhrs[a]){this._xhrs[a].abort();this._xhrs[a]=null}}});Framework.Constants.TEMPLATES.listing='<% for( var i=0;i<results.length; i++ ) { var datetime = Framework.Utils.get_datetime_formatted(results[i].time); %> 		<h3 class="list_header" eventid="<%=(results[i].id || results[i].url)%>">			<a href="#">				<div class="list_item_image">					<img src="<%=results[i].pic%>" />					<% if( results[i].timeless ) { %>					<br/><%=jQuery.timeago(new Date(results[i].time))%>					<% } %>				</div>				<ul class="list_item_header">					<li class="name" title="<%=results[i].name%>"><%=Framework.Utils.shorten(results[i].name, 500)%></li>					<li class="calendar-container"><% if(!results[i].timeless) { %><div class="calendar-box <%=datetime.dayofweek%>"><%=datetime.day%></div><%}%></li>					<li class="datetime"><% if(!results[i].timeless && datetime.time) { %><%=datetime.time%><% } else { %>&nbsp;<% } %></li>					<% if( results[i].distance ) { %><li class="distance"><%=results[i].distance%> miles</li><% } %>					<li class="persons <% if(results[i].hasmsg) { %> show <% } %>" title="Activity Partners waiting"></li>				</ul>			</a>		</h3> 		<div class="list_item" eventid="<%=(results[i].id||results[i].url)%>"> 			<div class="edit_event <% if(Framework.Authentication.isUserLoggedIn() && results[i].owner == Framework.User.id) { %> show <% } %>" title="Edit your activity">Edit your circle</div>			<div class="cue-buttons">				<input type="button" class="discover-new ui-button ui-priority-primary ui-corner-all" value="Post Message">				<br/><a class="grow-circle">Grow The Circle</a>			</div> 			<div class="user_comments">			</div>			<% if(results[i].address) { %> 			<div class="location"><span class="accordion-titles">Location:</span> <a target=_blank href="http://maps.google.com/?q=<%=(results[i].coords?results[i].coords:results[i].address)%>"><%=results[i].address%></a></div> 			<% } %> 			<div class="description"><span class="accordion-titles">Description:</span> <%=results[i].description%></div> 			<div class="cost"><span class="accordion-titles">Cost:</span> <%=results[i].cost%></div> 			<a href="<%=results[i].url%>" target=_blank>Read More</a>		</div> <% } %> ';Framework.Constants.TEMPLATES.message='<div class="user_profile">	<a href="<%=user.url%>" target=_blank>		<img title="<%=user.name%>" src="<%=user.pic%>"/>	</a>	<div class="user_stuff">		<span class="user_name"><a href="<%=user.url%>" target=_blank><%=user.name%></a></span>		<span class="x-btn" style="display:none"><a></a></span><br/>		<span class="user_message"><%=message%></span><br/>		<div class="message-me" userid="<%=user.id%>"><a></a></div>	</div></div>';Framework.Constants.TEMPLATES.users='<li class="user_profile">	<a class="user-holder">		<img title="<%=user.name%>" src="<%=user.pic%>"/><br/>		<i><%=jQuery.timeago(user.last_login)%></i>	</a>	<div class="user_stuff">		<span class="user_likes"><%=Framework.Utils.capitaliseFirstLetter(user.activities)%></span><br/>	</div></li>';Framework.Constants.TEMPLATES.email='<%=message%><br/><br/><b>@Location:</b> <%=address%><br/><% if( !timeless ) { %><b>@Time:</b> <%=Framework.Utils.get_datetime_formatted_email(starttime)%><% } %><br/><br/><%=description%><br/><br/><%=calltoaction%><br/><a target="_blank" href="<%=Framework.ActivityStore.getLinkToActivity(id)%>"><%=Framework.ActivityStore.getLinkToActivity(id)%></a><br/><br/><hr/><span style="font-size: 9pt;"><a href="http://www.OpenCirclez.com">OpenCirclez</a> - Share Happenings Across Circles. <br/>You received this email because <b><%=Framework.User.name%></b> wants to share <b><%=Framework.Utils.capitaliseFirstLetter(tags)%></b> happenings with people located within <b><%=radius%></b> miles of <b><%=address%></b>.<br/><br/><a href="<%=Framework.SITE_URL%>#signin=<%=emailto%>">Update preferences</a> to get more relevant info. To stop receiving emails, <a href="<%=Framework.SITE_URL%>#signout=<%=emailto%>">unsubscribe</a></span>';